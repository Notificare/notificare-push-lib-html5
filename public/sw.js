/*!
 * Notificare -  v2.2.2 (https://notificare.com)
 * Copyright 2012 - 2020 Notificare
 * Licensed under UNLICENSED (https://github.com/Notificare/notificare-push-lib-html5-src/blob/master/LICENSE)
 */
self.addEventListener("push",function(n){try{var i=n.data.json();if(i["x-sender"]&&"notificare"===i["x-sender"])if(i.alert){if(i.actions){var e=[];i.actions.forEach(function(t){e.push({title:t.label,action:t.label})})}self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"notificationreceive",message:i.id}))})}),n.waitUntil(self.registration.showNotification(i.application,{body:i.alert,icon:i.icon,tag:i.id,actions:e,data:i,requireInteraction:i.requireInteraction,image:i.attachment&&i.attachment.uri?i.attachment.uri:null,sound:i.sound?i.sound:null}))}else i.system?n.waitUntil(self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"system",message:i}))})})):n.waitUntil(self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"notificationreceive",message:i.id}))})}));else n.waitUntil(self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"unknownpush",message:i}))})}))}catch(t){n.waitUntil(self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"workerpush",message:i}))})}))}}),self.addEventListener("notificationclick",function(e){e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then(function(t){if(0==t.length){var n=e.notification.data.urlFormatString.replace("%@",e.notification.tag);return e.action&&setTimeout(function(){clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"notificationreply",message:e.notification.tag,action:e.action,bg:!0}))})})},2e3),clients.openWindow(n)}var i=t[0];if(i&&"focus"in i)return e.action?self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"notificationreply",message:e.notification.tag,action:e.action,bg:!1}))})}):i.postMessage(JSON.stringify({cmd:"notificationclick",message:e.notification.tag})),i.focus()}))}),self.addEventListener("activate",function(t){clients.claim(),clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"activate"}))})})}),self.addEventListener("pushsubscriptionchange",function(t){clients.claim(),clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(JSON.stringify({cmd:"pushsubscriptionchange"}))})})}),self.addEventListener("install",function(t){t.waitUntil(self.skipWaiting())}),self.addEventListener("message",function(t){switch(JSON.parse(t.data).action){case"init":break;default:console.log(t)}});