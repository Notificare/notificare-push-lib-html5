/*!
 * Notificare -  v2.7.3 (https://notificare.com)
 * Copyright 2012 - 2023 Notificare
 */
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){s=!0,a=e},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var Notificare=function(){function o(e){_classCallCheck(this,o),this.options={sdkVersion:"2.7.3",fullHost:window.location.protocol+"//"+window.location.host,apiUrl:"https://cloud.notifica.re/api",awsStorage:"https://push.notifica.re/upload",websitePushUrl:"https://push.notifica.re/website-push/safari",assetsUrl:"https://push.notifica.re/asset/file/"},this.useAutoOnBoarding=!1,this.autoOnBoardingOptions=null,this.useFloatingButton=!1,this.floatingButtonOptions=null,this.deviceManager=null,this.network=null,this.eventLogger=null,this.geo=null,this.push=null,this.storage=null,this.core=new NotificareCore,this.onboarding=null,this.floatingButton=null;var t=this.messageUI=null;localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(t=localStorage.getItem("notificarePreferredLanguage")+"-"+localStorage.getItem("notificarePreferredRegion")),this.preferredLanguage=t,e&&(this.options=this.core.mergeOptions(e,this.options)),this.didActivateWorker=null,this.onReady=null,this.didRegisterDevice=null,this.didFailToRegisterDevice=null,this.didFailToRegisterForNotifications=null,this.didReceiveNotification=null,this.didReceiveSystemNotification=null,this.didReceiveUnknownNotification=null,this.didReceiveWorkerPush=null,this.didOpenNotification=null,this.willExecuteAction=null,this.didExecuteAction=null,this.didNotExecuteAction=null,this.didFailToExecuteAction=null,this.shouldPerformActionWithURL=null,this.didUpdateBadge=null,this.didUpdateLocation=null,this.didFailToUpdateLocation=null,this.didOpenNotificationPermission=null,this.didCancelOnBoarding=null,this.didClickFloatingButton=null,this.sessionTimeout=null,this.sessionCloseListenerTimeout=null,this.exponentialFallback=3e3,this.maxFallback=6e4;var i=document.createElement("style");i.setAttribute("id","notificareRebootUI"),document.getElementById("notificareRebootUI")||document.head.appendChild(i)}return _createClass(o,[{key:"launch",value:function(){var t=this;this.core.isLibrarySupported()&&this._launch().then(function(e){console.warn(e),t._initialSetup()}).catch(function(e){console.warn(e)})}},{key:"launchWithAutoOnBoarding",value:function(e){var t=this;this.core.isLibrarySupported()&&(this.useAutoOnBoarding=!0,this.autoOnBoardingOptions=e,this._launch().then(function(e){console.warn(e),t._initialSetup()}).catch(function(e){console.warn(e)}))}},{key:"launchWithFloatingButton",value:function(e){var t=this;this.core.isLibrarySupported()&&(this.useFloatingButton=!0,this.floatingButtonOptions=e,this._launch().then(function(e){console.warn(e),t._initialSetup()}).catch(function(e){console.warn(e)}))}},{key:"unlaunch",value:function(){var e=this;this.appConfig.application?(this.appConfig.application.services&&this.appConfig.application.services.locationServices&&this.geo.stopLocationUpdates(),this.inboxManager.clearInbox().then(function(){e.clearTags().then(function(){"WebPush"!==e.myDevice().transport&&"WebsitePush"!==e.myDevice().transport||e.push.unregisterForNotifications(),e.deviceManager.unregisterDevice()})})):console.warn("Notificare: You can only unlaunch after launch. Make sure you invoke unlaunch after the onReady event.")}},{key:"_launch",value:function(){var o=this;return new Promise(function(t,i){o.options&&o.options.appHost&&o.options.appVersion&&o.options.appKey&&o.options.appSecret&&o.options.serviceWorker?(o.options.useTestEnv&&(o.options=o.core.mergeOptions({apiUrl:"https://cloud-test.notifica.re/api",awsStorage:"https://push-test.notifica.re/upload",websitePushUrl:"https://push-test.notifica.re/website-push/safari",assetsUrl:"https://push-test.notifica.re/asset/file/"},o.options)),t("Notificare: Overriding config.json")):"undefined"!=typeof NOTIFICARE_PLUGIN_OPTIONS?(o.options=o.core.mergeOptions(NOTIFICARE_PLUGIN_OPTIONS,o.options),o.options.useTestEnv&&(o.options=o.core.mergeOptions({apiUrl:"https://cloud-test.notifica.re/api",awsStorage:"https://push-test.notifica.re/upload",websitePushUrl:"https://push-test.notifica.re/website-push/safari",assetsUrl:"https://push-test.notifica.re/asset/file/"},o.options)),o.options?t("Notificare: Loaded successfully NOTIFICARE_PLUGIN_OPTIONS"):i("Notificare: Failed to load NOTIFICARE_PLUGIN_OPTIONS.")):fetch("/config.json").then(function(e){return e.json()}).then(function(e){o.options=o.core.mergeOptions(e,o.options),o.options.useTestEnv&&(o.options=o.core.mergeOptions({apiUrl:"https://cloud-test.notifica.re/api",awsStorage:"https://push-test.notifica.re/upload",websitePushUrl:"https://push-test.notifica.re/website-push/safari",assetsUrl:"https://push-test.notifica.re/asset/file/"},o.options)),o.options?t("Notificare: Loaded successfully /config.json"):i("Notificare: Failed to load /config.json options, please check your config file.")}).catch(function(){i("Notificare: Failed to load /config.json, please check your config file.")})})}},{key:"_initialSetup",value:function(){var o=this;this.network=new NotificareNetwork(this.options),this.appConfig=new NotificareAppConfig(this.options),this.eventLogger=new NotificareEventLogger(this.options),this.deviceManager=new NotificareDeviceManager(this.options),this.geo=new NotificareGeo(this.options),this.push=new NotificarePush(this.options),this.storage=new NotificareStorage(this.options),this.scannables=new NotificareScannables(this.options),this.loyalty=new NotificareLoyalty(this.options),this.inboxManager=new NotificareInboxManager(this.options),this.messageUI=new NotificareMessageUI(this.options),this._migrateOldVersions(),this.options&&this.options.ignoreNonWebPushDevices&&this.myDevice()&&"Notificare"===this.myDevice().transport&&localStorage.removeItem("notificareDevice"),this.options&&this.options.allowOnlyWebPushSupportedDevices&&!this.core.isWebPushSupported()||this.appConfig.fetchApplicationInfo().then(function(e){o.deviceManager.didRegisterDevice=function(e){"function"==typeof o.didRegisterDevice&&o.didRegisterDevice(e),parseInt(localStorage.getItem("notificareRegistration"))||(o.eventLogger.event("re.notifica.event.application.Install",null),o.eventLogger.event("re.notifica.event.application.Registration",null),localStorage.setItem("notificareRegistration",1))},o.deviceManager.didFailToRegisterDevice=function(e){"function"==typeof o.didFailToRegisterDevice&&o.didFailToRegisterDevice(e)},o.myDevice().deviceID?o.options.appVersion!==o.myDevice().appVersion&&o.eventLogger.event("re.notifica.event.application.Upgrade",null):(localStorage.getItem("notificareRegistration")||localStorage.setItem("notificareRegistration",0),o.options.ignoreNonWebPushDevices||o.deviceManager.registerTemporaryDevice()),o.push.didUnsubscribePushRegistration=function(){o.options.ignoreNonWebPushDevices?o.myDevice().deviceID&&o.deviceManager.unregisterDevice():o.deviceManager.registerTemporaryDevice()},o.push.didReceiveNotification=function(e){"function"==typeof o.didReceiveNotification&&o.didReceiveNotification(e),o.inboxManager.refreshBadge(),o.eventLogger.event("re.notifica.event.notification.Receive",{notification:e})},o.push.didClickNotification=function(e,t){o._handleOpenNotification(e)},o.push.didClickReplyInNotification=function(e,t,i){o.network.fetch("GET","/notification/"+e).then(function(e){e&&e.notification&&(o.push.handleAction(e.notification,t),o.inboxManager.refreshBadge())}),i||o.eventLogger.event("re.notifica.event.notification.Open",{notification:e})},o.push.didReceiveSystemNotification=function(e){e.systemType&&e.systemType.match(/^re\.notifica\./)?"re.notifica.notification.system.Application"===e.systemType&&o.appConfig.fetchApplicationInfo():"function"==typeof o.didReceiveSystemNotification&&o.didReceiveSystemNotification(e)},o.push.didReceiveWorkerPush=function(e){"function"==typeof o.didReceiveWorkerPush&&o.didReceiveWorkerPush(e)},o.push.didReceiveWorkerUnknownPush=function(e){"function"==typeof o.didReceiveUnknownNotification&&o.didReceiveUnknownNotification(e)},o.push.willExecuteAction=function(e,t){"function"==typeof o.willExecuteAction&&o.willExecuteAction(e,t)},o.push.didExecuteAction=function(e,t){"function"==typeof o.didExecuteAction&&o.didExecuteAction(e,t)},o.push.didNotExecuteAction=function(e,t){"function"==typeof o.didNotExecuteAction&&o.didNotExecuteAction(e,t)},o.push.didFailToExecuteAction=function(e,t){"function"==typeof o.didFailToExecuteAction&&o.didFailToExecuteAction(e,t)},o.push.shouldPerformActionWithURL=function(e){"function"==typeof o.shouldPerformActionWithURL&&o.shouldPerformActionWithURL(e)},o.inboxManager.didUpdateBadge=function(e){"function"==typeof o.didUpdateBadge&&o.didUpdateBadge(e)},o.geo.didUpdateLocation=function(e){"function"==typeof o.didUpdateLocation&&o.didUpdateLocation(e)},o.geo.didFailToUpdateLocation=function(e){"function"==typeof o.didFailToUpdateLocation&&o.didFailToUpdateLocation(e)},o.inboxManager.refreshBadge(),o._start(e)}).catch(function(e){e instanceof Response?e&&e.status&&(0===e.status||502===e.status||503===e.status||400===e.status)&&(console.warn("Notificare: Failed to load application, retrying exponentially..."),setTimeout(o._initialSetup.bind(o),o.exponentialFallback),o.exponentialFallback<o.maxFallback?o.exponentialFallback*=2:o.exponentialFallback=o.maxFallback):console.log(e)})}},{key:"_start",value:function(e){var t=this;if(this.useAutoOnBoarding&&this._handleOnBoarding(),this.useFloatingButton&&this._handleFloatingButton(),"function"==typeof this.onReady&&this.onReady(e),this._handleURLChange(),this._handleTestDeviceRegistration(),localStorage.getItem("notificareSession")&&localStorage.getItem("notificareUnloadTimestamp")&&this.myDevice().deviceID){var i=JSON.parse(localStorage.getItem("notificareUnloadTimestamp")),o=Date.now()-1e4;if(i&&i.timestamp&&parseInt(i.timestamp)<o){var n=JSON.parse(localStorage.getItem("notificareSession"));n&&n.start&&this.eventLogger.event("re.notifica.event.application.Close",{data:{timestamp:parseInt(i.timestamp),length:this.core.secondsBetweenDates(new Date,new Date(n.start))}}).then(function(){localStorage.removeItem("notificareSession"),localStorage.removeItem("notificareUnloadTimestamp")})}}!localStorage.getItem("notificareSession")&&this.myDevice().deviceID&&(localStorage.setItem("notificareSession",JSON.stringify({id:this.core.uuidv4(),start:new Date})),this.eventLogger.event("re.notifica.event.application.Open",null)),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState?(!localStorage.getItem("notificareSession")&&t.myDevice().deviceID&&(localStorage.setItem("notificareSession",JSON.stringify({id:t.core.uuidv4(),start:new Date})),t.eventLogger.event("re.notifica.event.application.Open",null)),t.sessionCloseListenerTimeout&&clearTimeout(t.sessionCloseListenerTimeout)):"hidden"===document.visibilityState&&localStorage.getItem("notificareSession")&&t.myDevice().deviceID&&(t.sessionCloseListenerTimeout=setTimeout(function(){var e=JSON.parse(localStorage.getItem("notificareSession"));e&&e.start&&t.eventLogger.event("re.notifica.event.application.Close",{data:{length:t.core.secondsBetweenDates(new Date,new Date(e.start))}}).then(function(){localStorage.removeItem("notificareSession")})},6e5))},!1),window.addEventListener("beforeunload",function(){localStorage.setItem("notificareUnloadTimestamp",JSON.stringify({timestamp:Date.now()}))})}},{key:"_handleURLChange",value:function(){if(!("serviceWorker"in navigator)&&this.appConfig.application&&this.appConfig.application.websitePushConfig&&this.appConfig.application.websitePushConfig.urlFormatString){var e=new RegExp(this.appConfig.application.websitePushConfig.urlFormatString.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1").replace("%@","(\\w+)")).exec(window.location);if(e&&1<e.length)this._handleOpenNotification(e[1]);else{var t,i=new URL(this.appConfig.application.websitePushConfig.urlFormatString),o=new URLSearchParams(i.search),n=new URLSearchParams(window.location.search),a=_createForOfIteratorHelper(o.entries());try{for(a.s();!(t=a.n()).done;){var r=t.value;"%@"===r[1]&&n.has(r[0])&&this._handleOpenNotification(n.get(r[0]))}}catch(e){a.e(e)}finally{a.f()}}}}},{key:"_handleTestDeviceRegistration",value:function(){var e=new URLSearchParams(window.location.search);if(e&&e.has("notificareTestNonce")){var t=e.get("notificareTestNonce");this.deviceManager.registerTestDevice(t).then(function(){console.warn("Notificare: Registered test device successfully.")}).catch(function(){console.warn("Notificare: Failed to register test device")})}}},{key:"_handleOpenNotification",value:function(e){var t=this;this.push.openNotification(e).then(function(e){t.inboxManager.refreshBadge(),"function"==typeof t.didOpenNotification&&t.didOpenNotification(e)})}},{key:"_migrateOldVersions",value:function(){if(localStorage.getItem("deviceToken")){var e=new Date,t=new RegExp("http");localStorage.setItem("notificareDevice",JSON.stringify({oldDeviceID:null,keys:null,userID:null,userName:null,language:null,region:null,deviceID:localStorage.getItem("deviceToken"),platform:"Web",transport:t.test(localStorage.getItem("deviceToken"))?"WebPush":"WebsitePush",sdkVersion:this.options.sdkVersion,appVersion:this.options.appVersion,timeZoneOffset:e.getTimezoneOffset()/60*-1,allowedUI:!0,webPushCapable:this.core.isWebPushSupported(),userAgent:navigator.userAgent})),localStorage.setItem("notificareRegistration",1),localStorage.removeItem("deviceToken")}localStorage.getItem("badge")&&localStorage.removeItem("badge"),localStorage.getItem("position")&&localStorage.removeItem("position"),localStorage.getItem("regions")&&localStorage.removeItem("regions")}},{key:"_handleOnBoarding",value:function(){var e=this;if(this.onboarding=new NotificareOnBoarding(this.options),this.isWebPushEnabled())this.registerForNotifications();else{var t=!1,i=localStorage.getItem("notificareOnboardingLastAttempt"),o=this.autoOnBoardingOptions.retryAfterInterval?36e5*parseInt(this.autoOnBoardingOptions.retryAfterInterval):864e5;(!i||i&&parseInt(i)<Date.now()-o)&&(t=!0),t&&!this.isWebPushDeniedByUser()&&this.core.isWebPushSupported()&&(this.autoOnBoardingOptions.showAfterDelay&&!isNaN(this.autoOnBoardingOptions.showAfterDelay)?setTimeout(function(){e.onboarding.show(e.appConfig.application,e.autoOnBoardingOptions)},1e3*this.autoOnBoardingOptions.showAfterDelay):this.onboarding.show(this.appConfig.application,this.autoOnBoardingOptions),this.onboarding.didOpenNotificationPermission=function(){localStorage.removeItem("notificareOnboardingLastAttempt"),e.onboarding.hide(),e.registerForNotifications(),"function"==typeof e.didOpenNotificationPermission&&e.didOpenNotificationPermission()},this.onboarding.didCancelOnBoarding=function(){e.onboarding.hide(),localStorage.setItem("notificareOnboardingLastAttempt",Date.now()),"function"==typeof e.didCancelOnBoarding&&e.didCancelOnBoarding()})}}},{key:"_handleFloatingButton",value:function(){var e=this;this.floatingButton=new NotificareFloatingButton(this.appConfig,this.floatingButtonOptions),this.floatingButton.show(),this.isWebPushEnabled()?this.registerForNotifications():this.core.isWebPushSupported()&&(this.floatingButton.didClickFloatingButton=function(){e.registerForNotifications(),"function"==typeof e.didClickFloatingButton&&e.didClickFloatingButton()})}},{key:"isWebPushSupported",value:function(){return this.core.isWebPushSupported()}},{key:"isWebPushEnabled",value:function(){var e=!1;return"granted"===this.fetchWebPushPermission()&&(e=!0),e}},{key:"isWebPushDeniedByUser",value:function(){var e=!1;return"denied"===this.fetchWebPushPermission()&&(e=!0),e}},{key:"fetchWebPushPermission",value:function(){var e="default";"serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window&&"Notification"in window&&Notification.permission?e=Notification.permission:"safari"in window&&"pushNotification"in window.safari&&this.appConfig&&this.appConfig.application&&this.appConfig.application.websitePushConfig.info&&this.appConfig.application.websitePushConfig.info.subject&&this.appConfig.application.websitePushConfig.info.subject.UID&&(e=window.safari.pushNotification.permission(this.appConfig.application.websitePushConfig.info.subject.UID).permission);return e}},{key:"presentNotification",value:function(e){var i=this;this.messageUI.show(this.appConfig.application,e),this.messageUI.didClickAction=function(e,t){i.handleAction(e,t)}}},{key:"isLocationServicesEnabled",value:function(){return!!localStorage.getItem("notificarePosition")}},{key:"registerForNotifications",value:function(){var t=this;this.push.registerForNotifications().then(function(e){e&&"serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window?t.deviceManager.registerWebPushDevice(e):e&&"safari"in window&&"pushNotification"in window.safari&&t.deviceManager.registerSafariDevice(e)}).catch(function(e){"function"==typeof t.didFailToRegisterForNotifications&&t.didFailToRegisterForNotifications(e),t.myDevice()&&"Notificare"===t.myDevice().platform&&t.myDevice().deviceID&&!t.options.ignoreNonWebPushDevices&&t.registerDevice(t.myDevice().userID,t.myDevice().userName),t.isWebPushDeniedByUser()&&t.useAutoOnBoarding})}},{key:"unregisterForNotifications",value:function(){this.push.unregisterForNotifications()}},{key:"registerDevice",value:function(e,t){return this.deviceManager.registerDevice(e,t)}},{key:"unregisterDevice",value:function(){return this.deviceManager.unregisterDevice()}},{key:"myDevice",value:function(){var e=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):{deviceID:null,oldDeviceID:null,keys:null,userID:null,userName:null,platform:null,sdkVersion:null,appVersion:null,language:null,region:null,transport:null,timeZoneOffset:null,allowedUI:!1,webPushCapable:null,userAgent:null};return localStorage.getItem("notificarePosition")&&(e.location=JSON.parse(localStorage.getItem("notificarePosition"))),e}},{key:"updatePreferredLanguage",value:function(e){if(e){var t=e.split("-");return t&&2===t.length?t[0]+"-"+t[0]!=localStorage.getItem("notificarePreferredLanguage")+"-"+localStorage.getItem("notificarePreferredRegion")?(localStorage.setItem("notificarePreferredLanguage",t[0]),localStorage.setItem("notificarePreferredRegion",t[1]),this.preferredLanguage=localStorage.getItem("notificarePreferredLanguage")+"-"+localStorage.getItem("notificarePreferredRegion"),this.deviceManager.updateLanguage(t[0],t[1])):Promise.resolve({message:"Skipping preferred language update, nothing changed."}):Promise.reject(new Error("Not a valid preferred language. Use a ISO 639-1 language code and a ISO 3166-2 region code (e.g. en-US)."))}return localStorage.removeItem("notificarePreferredLanguage"),localStorage.removeItem("notificarePreferredRegion"),this.preferredLanguage=null,this.deviceManager.updateLanguage(this.core.deviceLanguage(),this.core.deviceRegion())}},{key:"fetchTags",value:function(){return this.deviceManager.fetchTags()}},{key:"addTag",value:function(e){return this.deviceManager.addTag(e)}},{key:"addTags",value:function(e){return this.deviceManager.addTags(e)}},{key:"removeTag",value:function(e){return this.deviceManager.removeTag(e)}},{key:"removeTags",value:function(e){return this.deviceManager.removeTags(e)}},{key:"clearTags",value:function(){return this.deviceManager.clearTags()}},{key:"fetchUserData",value:function(){var e=this;return this.deviceManager.fetchUserData().then(function(i){var o=[];return e.appConfig.application.userDataFields&&0<e.appConfig.application.userDataFields.length&&e.appConfig.application.userDataFields.forEach(function(e){var t=e;i.userData&&i.userData[e.key]?t.value=i.userData[e.key]:t.value="",o.push(t)}),o})}},{key:"updateUserData",value:function(e){var t={};return e.forEach(function(e){t[e.key]=e.value}),this.deviceManager.updateUserData(t)}},{key:"fetchDoNotDisturb",value:function(){return this.deviceManager.fetchDoNotDisturb()}},{key:"updateDoNotDisturb",value:function(e,t){return this.deviceManager.updateDoNotDisturb({start:e,end:t})}},{key:"clearDoNotDisturb",value:function(){return this.deviceManager.clearDoNotDisturb()}},{key:"startLocationUpdates",value:function(){this.appConfig.application.services&&this.appConfig.application.services.locationServices?this.geo.startLocationUpdates():"function"==typeof this.didFailToUpdateLocation&&this.didFailToUpdateLocation(new Error("Location Services is not available for your account"))}},{key:"stopLocationUpdates",value:function(){if(this.appConfig.application.services&&this.appConfig.application.services.locationServices)return this.geo.stopLocationUpdates()}},{key:"fetchAssets",value:function(e){return this.appConfig.application.services&&this.appConfig.application.services.storage?this.storage.fetchAssets(e):Promise.reject(new Error("Storage is not available for your account"))}},{key:"fetchScannables",value:function(e){return this.scannables.fetchScannable(e)}},{key:"fetchPassWithSerial",value:function(e){return this.appConfig.application.services&&this.appConfig.application.services.loyalty?this.loyalty.fetchPassWithSerial(e):Promise.reject(new Error("Loyalty is not available for your account"))}},{key:"fetchPassWithBarcode",value:function(e){return this.appConfig.application.services&&this.appConfig.application.services.loyalty?this.loyalty.fetchPassWithBarcode(e):Promise.reject(new Error("Loyalty is not available for your account"))}},{key:"logCustomEvent",value:function(e,t){if(e){var i="re.notifica.event.custom."+e;return this.eventLogger.event(i,t?{data:t}:null)}return Promise.reject(new Error("No event name provided"))}},{key:"handleAction",value:function(e,t){this.push.handleAction(e,t)}},{key:"performCloudAPIRequest",value:function(e,t,i){return this.network.fetch(e,t,!0,i)}}]),o}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareAppConfig=function(){function t(e){_classCallCheck(this,t),this.options=e,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options),this.application=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null}return _createClass(t,[{key:"fetchApplicationInfo",value:function(){var o=this;return new Promise(function(t,i){o.network.fetch("GET","/application/info").then(function(e){e&&e.application&&(localStorage.setItem("notificareApplication",JSON.stringify(e.application)),o.application=JSON.parse(localStorage.getItem("notificareApplication")),t(o.application))}).catch(function(e){i(e)})})}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareCore=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"mergeOptions",value:function(t,i){return Object.keys(t).forEach(function(e){i[e]=t[e]}),i}},{key:"randomId",value:function(){return Math.floor(1e16*(1+Math.random())).toString(16).substring(1)}},{key:"uuidv4",value:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})}},{key:"getPushToken",value:function(e){return{endpoint:e.endpoint,keys:this.getPushKeys(e)}}},{key:"getPushKeys",value:function(e){if(e&&e.getKey){var t=e.getKey("p256dh"),i=e.getKey("auth");return t&&i?{p256dh:this.arrayBufferToBase64(t),auth:this.arrayBufferToBase64(i)}:null}return null}},{key:"base64UrlToUint8Array",value:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),o=new Uint8Array(i.length),n=0;n<i.length;++n)o[n]=i.charCodeAt(n);return o}},{key:"arrayBufferToBase64",value:function(e){return this.uint8ArrayToBase64(new Uint8Array(e))}},{key:"arrayBufferToBase64Url",value:function(e){return this.uint8ArrayToBase64Url(new Uint8Array(e))}},{key:"uint8ArrayToBase64",value:function(e){for(var t="",i=e.byteLength,o=0;o<i;o++)t+=String.fromCharCode(e[o]);return window.btoa(t)}},{key:"uint8ArrayToBase64Url",value:function(e){return this.uint8ArrayToBase64(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/g,"")}},{key:"postMessageToServiceWorker",value:function(o){return new Promise(function(t,i){var e=new MessageChannel;e.port1.onmessage=function(e){e.data.error?i(e.data.error):t(e.data)},navigator.serviceWorker.controller.postMessage(JSON.stringify(o),[e.port2])})}},{key:"distanceBetweenPoints",value:function(e,t){var i=e.latitude,o=t.latitude,n=e.longitude,a=t.longitude,r=i*Math.PI/180,s=o*Math.PI/180,c=(o-i)*Math.PI/180,l=(a-n)*Math.PI/180,u=Math.sin(c/2)*Math.sin(c/2)+Math.cos(r)*Math.cos(s)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}},{key:"secondsBetweenDates",value:function(e,t){var i=(e.getTime()-t.getTime())/1e3;return Math.abs(i)}},{key:"deviceLanguage",value:function(){var e="en",t=(window.navigator.userLanguage||window.navigator.language).split("-");return t&&0<t.length&&(e=t[0]),e}},{key:"deviceRegion",value:function(){var e="US",t=(window.navigator.userLanguage||window.navigator.language).split("-");return t&&1<t.length&&(e=t[1]),e}},{key:"fetchLocallyStoredProperty",value:function(e){return e&&localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):null}},{key:"isWebPushSupported",value:function(){return"serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window&&void 0===window.navigator.standalone||"serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window&&!0===window.navigator.standalone||"safari"in window&&"pushNotification"in window.safari}},{key:"isLibrarySupported",value:function(){var e=!0;return window.fetch&&window.crypto&&window.localStorage&&window.Promise&&window.JSON||(e=!1),e}}]),e}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareDeviceManager=function(){function t(e){_classCallCheck(this,t),this.options=e,this.network=new NotificareNetwork(this.options),this.core=new NotificareCore,this.device=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):{deviceID:null,oldDeviceID:null,keys:null,userID:null,userName:null,platform:null,sdkVersion:null,appVersion:null,language:null,region:null,transport:null,timeZoneOffset:null,allowedUI:!1,webPushCapable:null,userAgent:null},this.didRegisterDevice=null,this.didFailToRegisterDevice=null}return _createClass(t,[{key:"registerTemporaryDevice",value:function(){var t=this,e=this.core.deviceLanguage(),i=this.core.deviceRegion();localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(e=localStorage.getItem("notificarePreferredLanguage"),i=localStorage.getItem("notificarePreferredRegion"));var o=new Date,n=this.core.uuidv4(),a={deviceID:n,oldDeviceID:this.device.deviceID&&this.device.deviceID!=n?this.device.deviceID:null,keys:null,userID:this.device.userID,userName:this.device.userID?this.device.userName:null,platform:"Web",sdkVersion:this.options.sdkVersion,appVersion:this.options.appVersion,language:e,region:i,transport:"Notificare",timeZoneOffset:o.getTimezoneOffset()/60*-1,allowedUI:!1,webPushCapable:this.core.isWebPushSupported(),userAgent:navigator.userAgent};this._registerDevice(a).then(function(){a.language=t.core.deviceLanguage(),a.region=t.core.deviceRegion(),localStorage.setItem("notificareDevice",JSON.stringify(a)),t.device=JSON.parse(localStorage.getItem("notificareDevice")),t.didRegisterDevice(t.device)}).catch(function(e){t.didFailToRegisterDevice(e)})}},{key:"registerWebPushDevice",value:function(e){var t=this,i=this.core.deviceLanguage(),o=this.core.deviceRegion();localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(i=localStorage.getItem("notificarePreferredLanguage"),o=localStorage.getItem("notificarePreferredRegion"));var n=new Date,a=e.endpoint,r=e.keys,s={deviceID:a,oldDeviceID:this.device.deviceID&&this.device.deviceID!=a?this.device.deviceID:null,keys:r,userID:this.device.userID,userName:this.device.userID?this.device.userName:null,platform:"Web",sdkVersion:this.options.sdkVersion,appVersion:this.options.appVersion,language:i,region:o,transport:"WebPush",timeZoneOffset:n.getTimezoneOffset()/60*-1,allowedUI:!0,webPushCapable:this.core.isWebPushSupported(),userAgent:navigator.userAgent};this._registerDevice(s).then(function(){s.language=t.core.deviceLanguage(),s.region=t.core.deviceRegion(),localStorage.setItem("notificareDevice",JSON.stringify(s)),t.device=JSON.parse(localStorage.getItem("notificareDevice")),t.didRegisterDevice(t.device)}).catch(function(e){t.didFailToRegisterDevice(e)})}},{key:"registerSafariDevice",value:function(e){var t=this,i=this.core.deviceLanguage(),o=this.core.deviceRegion();localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(i=localStorage.getItem("notificarePreferredLanguage"),o=localStorage.getItem("notificarePreferredRegion"));var n=new Date,a={deviceID:e,oldDeviceID:this.device.deviceID&&this.device.deviceID!=e?this.device.deviceID:null,keys:null,userID:this.device.userID,userName:this.device.userID?this.device.userName:null,platform:"Web",sdkVersion:this.options.sdkVersion,appVersion:this.options.appVersion,language:i,region:o,transport:"WebsitePush",timeZoneOffset:n.getTimezoneOffset()/60*-1,allowedUI:!0,webPushCapable:this.core.isWebPushSupported(),userAgent:navigator.userAgent};this._registerDevice(a).then(function(){a.language=t.core.deviceLanguage(),a.region=t.core.deviceRegion(),localStorage.setItem("notificareDevice",JSON.stringify(a)),t.device=JSON.parse(localStorage.getItem("notificareDevice")),t.didRegisterDevice(t.device)}).catch(function(e){t.didFailToRegisterDevice(e)})}},{key:"registerDevice",value:function(e,t){var i=this;return this.device.userID=e,this.device.userName=e?t:null,this._registerDevice(this.device).then(function(){return localStorage.setItem("notificareDevice",JSON.stringify(i.device)),i.device=JSON.parse(localStorage.getItem("notificareDevice")),i.device})}},{key:"_registerDevice",value:function(e){return e&&e.deviceID?this.network.fetch("POST","/device",!0,e):Promise.reject(new Error("No device token found"))}},{key:"unregisterDevice",value:function(){var e=this;return this._unregisterDevice().then(function(){return e.device={deviceID:null,oldDeviceID:null,keys:null,userID:null,userName:null,platform:null,sdkVersion:null,appVersion:null,language:null,region:null,transport:null,timeZoneOffset:null,allowedUI:!1,webPushCapable:null,userAgent:null},localStorage.setItem("notificareDevice",e.device),e.device})}},{key:"_unregisterDevice",value:function(){return this.device&&this.device.deviceID?this.network.fetch("DELETE","/device/"+encodeURIComponent(this.device.deviceID),!0,null):Promise.reject(new Error("No device token found"))}},{key:"updateLanguage",value:function(e,t){var i=this;return this.device.language=e,this.device.region=t,this._registerDevice(this.device).then(function(){return i.device.language=i.core.deviceLanguage(),i.device.region=i.core.deviceRegion(),localStorage.setItem("notificareDevice",JSON.stringify(i.device)),i.device=JSON.parse(localStorage.getItem("notificareDevice")),i.device})}},{key:"fetchTags",value:function(){return this.device&&this.device.deviceID?this.network.fetch("GET","/device/"+encodeURIComponent(this.device.deviceID)+"/tags").then(function(e){var t=[];return e&&e.tags&&0<e.tags.length&&e.tags.forEach(function(e){t.push(e)}),t}):Promise.reject(new Error("No device token found"))}},{key:"addTag",value:function(e){return this.device&&this.device.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/addtag",!0,{tag:e}):Promise.reject(new Error("No device token found"))}},{key:"addTags",value:function(e){return this.device&&this.device.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/addtags",!0,{tags:e}):Promise.reject(new Error("No device token found"))}},{key:"removeTag",value:function(e){return this.device&&this.device.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/removetag",!0,{tag:e}):Promise.reject(new Error("No device token found"))}},{key:"removeTags",value:function(e){return this.device&&this.device.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/removetags",!0,{tags:e}):Promise.reject(new Error("No device token found"))}},{key:"clearTags",value:function(){return this.device&&this.device.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/cleartags"):Promise.reject(new Error("No device token found"))}},{key:"fetchUserData",value:function(){return this.device&&this.device.deviceID?this.network.fetch("GET","/device/"+encodeURIComponent(this.device.deviceID)+"/userdata"):Promise.reject(new Error("No device token found"))}},{key:"updateUserData",value:function(e){return this.device&&this.device.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/userdata",!0,e):Promise.reject(new Error("No device token found"))}},{key:"fetchDoNotDisturb",value:function(){return this.device&&this.device.deviceID?this.network.fetch("GET","/device/"+encodeURIComponent(this.device.deviceID)+"/dnd").then(function(e){return e.dnd}):Promise.reject(new Error("No device token found"))}},{key:"updateDoNotDisturb",value:function(e){return this.device&&this.device.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/dnd",!0,e):Promise.reject(new Error("No device token found"))}},{key:"clearDoNotDisturb",value:function(){return this.device&&this.device.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/cleardnd"):Promise.reject(new Error("No device token found"))}},{key:"registerTestDevice",value:function(e){return e?this.device&&this.device.deviceID?this.network.fetch("PUT","/support/testdevice/"+e,!0,{deviceID:this.device.deviceID}):Promise.reject(new Error("No device token found")):Promise.reject(new Error("No token found"))}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareEventLogger=function(){function t(e){_classCallCheck(this,t),this.options=e,this.network=new NotificareNetwork(this.options)}return _createClass(t,[{key:"event",value:function(e,t){var i={},o=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;if(o&&o.userID&&(i.userID=o.userID),e&&(i.type=e),localStorage.getItem("notificareSession")){var n=JSON.parse(localStorage.getItem("notificareSession"));i.sessionID=n.id}return t&&t.notification&&(i.notification=t.notification),t&&t.data&&(i.data=t.data),t&&t.data&&t.data.timestamp&&(i.timestamp=t.data.timestamp),o&&o.deviceID?(i.deviceID=o.deviceID,this.network.fetch("POST","/event",!0,i)):Promise.reject(new Error("No device token found when registering "+i.type))}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareFloatingButton=function(){function i(e,t){_classCallCheck(this,i),this.options=t,this.appConfig=e,this.currentPermissionState="default",this.didClickFloatingButton=null,this.FLOATING_BUTTON_CONSTANTS={body:document.getElementsByTagName("BODY")[0],floatingButton:document.createElement("a"),buttonIcon:document.createElement("img"),stateIcon:document.createElement("div"),stateText:document.createElement("div")},document.getElementById("notificareRebootUI").innerHTML=".notificareModalNotification, .notificareModalNotification *, .notificareModalNotification *:after, .notificareModalNotification *:before, .notificareModal, .notificareModal *, .notificareModal *:after, .notificareModal *:before, .notificareFloatingButton, .notificareFloatingButton *, .notificareFloatingButton *:after, .notificareFloatingButton *:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.position="fixed",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.width="60px",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.height="60px",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.display="flex",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.background="#e54142",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.border="3px solid black",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.borderRadius="100%",this.FLOATING_BUTTON_CONSTANTS.floatingButton.href="",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.textDecoration="none",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.color="white",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.boxShadow="10px 10px 23px -6px rgba(0,0,0,0.26)",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.zIndex="2147483647",this.FLOATING_BUTTON_CONSTANTS.floatingButton.className="notificareFloatingButton",this.FLOATING_BUTTON_CONSTANTS.stateText.style.position="fixed",this.FLOATING_BUTTON_CONSTANTS.stateText.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this.FLOATING_BUTTON_CONSTANTS.stateText.style.fontSize="14px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.width="300px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.height="60px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.lineHeight="1.2",this.FLOATING_BUTTON_CONSTANTS.stateText.style.textAlign="center",this.FLOATING_BUTTON_CONSTANTS.stateText.style.background="white",this.FLOATING_BUTTON_CONSTANTS.stateText.style.border="3px solid black",this.FLOATING_BUTTON_CONSTANTS.stateText.style.textDecoration="none",this.FLOATING_BUTTON_CONSTANTS.stateText.style.color="black",this.FLOATING_BUTTON_CONSTANTS.stateText.style.boxShadow="10px 10px 23px -6px rgba(0,0,0,0.26)",this.FLOATING_BUTTON_CONSTANTS.stateText.style.zIndex="2147483646",this.FLOATING_BUTTON_CONSTANTS.stateText.className="ntcStateText",this.FLOATING_BUTTON_CONSTANTS.buttonIcon.style.width="40px",this.FLOATING_BUTTON_CONSTANTS.buttonIcon.style.height="40px",this.FLOATING_BUTTON_CONSTANTS.buttonIcon.style.margin="auto",this.FLOATING_BUTTON_CONSTANTS.buttonIcon.setAttribute("src","https://cdn.notifica.re/libs/html5/v2/assets/webpush_bell.svg"),this.FLOATING_BUTTON_CONSTANTS.buttonIcon.className="ntcButtonIcon",this.FLOATING_BUTTON_CONSTANTS.floatingButton.appendChild(this.FLOATING_BUTTON_CONSTANTS.buttonIcon),this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.position="absolute",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.width="20px",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.height="20px",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.top="-3px",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.right="-3px",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.display="flex",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.alignItems="center",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.justifyContent="center",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.background="white",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.border="2px solid black",this.FLOATING_BUTTON_CONSTANTS.stateIcon.style.borderRadius="100%",this.FLOATING_BUTTON_CONSTANTS.stateIcon.className="ntcStateIcon"}return _createClass(i,[{key:"show",value:function(){var t=this;"top"===this.options.verticalAlignment&&"right"===this.options.horizontalAlignment&&(this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.top="50px",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.right="50px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.top="50px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.right="80px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.padding="10px 40px 10px 10px"),"top"===this.options.verticalAlignment&&"left"===this.options.horizontalAlignment&&(this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.top="50px",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.left="50px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.top="50px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.left="80px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.padding="10px 10px 10px 40px"),"bottom"===this.options.verticalAlignment&&"right"===this.options.horizontalAlignment&&(this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.bottom="50px",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.right="50px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.bottom="50px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.right="80px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.padding="10px 40px 10px 10px"),"bottom"===this.options.verticalAlignment&&"left"===this.options.horizontalAlignment&&(this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.bottom="50px",this.FLOATING_BUTTON_CONSTANTS.floatingButton.style.left="50px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.bottom="50px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.left="80px",this.FLOATING_BUTTON_CONSTANTS.stateText.style.padding="10px 10px 10px 40px"),this.FLOATING_BUTTON_CONSTANTS.body.appendChild(this.FLOATING_BUTTON_CONSTANTS.floatingButton),this.FLOATING_BUTTON_CONSTANTS.floatingButton.addEventListener("click",function(e){e.preventDefault(),"default"===t._fetchWebPushPermission()&&t.didClickFloatingButton()}),"default"!==this._fetchWebPushPermission()&&(this.FLOATING_BUTTON_CONSTANTS.stateIcon.innerHTML='<img src="https://cdn.notifica.re/libs/html5/v2/assets/webpush_'+this._fetchWebPushPermission()+'.svg" width="10" height="10">',this.FLOATING_BUTTON_CONSTANTS.floatingButton.appendChild(this.FLOATING_BUTTON_CONSTANTS.stateIcon)),this.FLOATING_BUTTON_CONSTANTS.floatingButton.addEventListener("mouseover",this.onFloatingButtonMouseOver.bind(this)),this.FLOATING_BUTTON_CONSTANTS.floatingButton.addEventListener("mouseout",this.onFloatingButtonMouseOut.bind(this)),this.currentPermissionState=this._fetchWebPushPermission(),setInterval(this.onPermissionStateChange.bind(this),2e3)}},{key:"onFloatingButtonMouseOver",value:function(e){e.preventDefault(),"default"===this._fetchWebPushPermission()&&(this.FLOATING_BUTTON_CONSTANTS.stateText.innerHTML=this.options.permissionTexts.default),"granted"===this._fetchWebPushPermission()&&(this.FLOATING_BUTTON_CONSTANTS.stateText.innerHTML=this.options.permissionTexts.granted),"denied"===this._fetchWebPushPermission()&&(this.FLOATING_BUTTON_CONSTANTS.stateText.innerHTML=this.options.permissionTexts.denied),this.FLOATING_BUTTON_CONSTANTS.body.appendChild(this.FLOATING_BUTTON_CONSTANTS.stateText)}},{key:"onFloatingButtonMouseOut",value:function(e){e.preventDefault(),this.FLOATING_BUTTON_CONSTANTS.stateText.remove()}},{key:"onPermissionStateChange",value:function(){"default"!==this._fetchWebPushPermission()?this.currentPermissionState!==this._fetchWebPushPermission()&&(this.FLOATING_BUTTON_CONSTANTS.stateIcon.innerHTML='<img src="https://cdn.notifica.re/libs/html5/v2/assets/webpush_'+this._fetchWebPushPermission()+'.svg" width="10" height="10">',document.body.contains(this.FLOATING_BUTTON_CONSTANTS.stateIcon)||this.FLOATING_BUTTON_CONSTANTS.floatingButton.appendChild(this.FLOATING_BUTTON_CONSTANTS.stateIcon)):this.FLOATING_BUTTON_CONSTANTS.stateIcon.remove(),this.currentPermissionState=this._fetchWebPushPermission()}},{key:"_fetchWebPushPermission",value:function(){var e="default";"Notification"in window&&Notification.permission&&(e=Notification.permission),"safari"in window&&"pushNotification"in window.safari&&this.appConfig&&this.appConfig.application&&this.appConfig.application.websitePushConfig.info&&this.appConfig.application.websitePushConfig.info.subject&&this.appConfig.application.websitePushConfig.info.subject.UID&&(e=window.safari.pushNotification.permission(this.appConfig.application.websitePushConfig.info.subject.UID).permission);return e}}]),i}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareGeo=function(){function t(e){_classCallCheck(this,t),this.options=e,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options),this.navigatorWatchPosition=null,this.didUpdateLocation=null,this.didFailToUpdateLocation=null}return _createClass(t,[{key:"startLocationUpdates",value:function(){var e=this;if("object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps))console.warn("Notificare: Using existing geocoder"),this._onStartLocationUpdates();else if(this.options.googleMapsAPIKey){var t=document.createElement("script");t.type="text/javascript",t.src="https://maps.googleapis.com/maps/api/js?key="+this.options.googleMapsAPIKey,document.body.appendChild(t),t.onload=function(){e._onStartLocationUpdates(),console.warn("Notificare: New geocoder ready to be used")},console.warn("Notificare: No geocoder found, adding one")}else this._onStartLocationUpdates(),console.warn("Notificare: No google maps API key provided nor any geocoder found, continuing without country discovery")}},{key:"_onStartLocationUpdates",value:function(){var t=this;navigator.geolocation&&(this.navigatorWatchPosition=navigator.geolocation.watchPosition(function(e){t._handleLocationUpdate(e).then(function(e){t.didUpdateLocation(e)}).catch(function(e){t.didFailToUpdateLocation(e)})},function(e){t.didFailToUpdateLocation(e)},this.options.geolocationOptions))}},{key:"stopLocationUpdates",value:function(){navigator.geolocation&&(navigator.geolocation.clearWatch(this.navigatorWatchPosition),this._updateLocation({coords:{latitude:null,longitude:null}},null).then(function(){localStorage.removeItem("notificarePosition")}))}},{key:"_handleLocationUpdate",value:function(o){var n=this;return new Promise(function(t,i){var e=localStorage.getItem("notificarePosition")?JSON.parse(localStorage.getItem("notificarePosition")):null;e&&e.latitude==o.coords.latitude&&e.longitude==o.coords.longitude?n._fetchNearestRegions(o).then(function(e){n._handleRegions(o,e.regions),t(o)}).catch(function(e){i(new Error(e))}):n._fetchDeviceCountry(o).then(function(e){n._updateLocation(o,e.country).then(function(){localStorage.setItem("notificarePosition",JSON.stringify({accuracy:isNaN(o.coords.accuracy)?null:o.coords.accuracy,altitude:isNaN(o.coords.altitude)?null:o.coords.altitude,altitudeAccuracy:isNaN(o.coords.altitudeAccuracy)?null:o.coords.altitudeAccuracy,heading:isNaN(o.coords.heading)?null:o.coords.heading,speed:isNaN(o.coords.speed)?null:o.coords.speed,latitude:o.coords.latitude,longitude:o.coords.longitude,country:e.country,timestamp:o.timestamp,locationServicesAuthStatus:"use",locationServicesAccuracyAuth:"full"})),n._fetchNearestRegions(o).then(function(e){n._handleRegions(o,e.regions),t(o)}).catch(function(e){i(new Error(e))})}).catch(function(e){i(e)})}).catch(function(e){i(e)})})}},{key:"_updateLocation",value:function(e,t){var i=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;return i&&i.deviceID?this.network.fetch("PUT","/device/"+encodeURIComponent(i.deviceID),!0,{latitude:e.coords.latitude,longitude:e.coords.longitude,altitude:isNaN(e.coords.altitude)?null:e.coords.altitude,bearing:isNaN(e.coords.heading)?null:e.coords.heading,speed:isNaN(e.coords.speed)?null:e.coords.speed,locationAccuracy:isNaN(e.coords.accuracy)?null:e.coords.accuracy,country:t,locationServicesAuthStatus:"use",locationServicesAccuracyAuth:"full",language:i.language,region:i.region}):Promise.reject(new Error("No device token found"))}},{key:"_fetchDeviceCountry",value:function(o){return new Promise(function(a,e){if("object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps)){var t=new google.maps.Geocoder,i={lat:o.coords.latitude,lng:o.coords.longitude};t.geocode({location:i},function(e,t){if(t==google.maps.GeocoderStatus.OK)if(e[0]){var i=null;if(e&&0<e.length)for(var o=0;o<e[0].address_components.length;o++)for(var n=0;n<e[0].address_components[o].types.length;n++)"country"==e[0].address_components[o].types[n]&&(i=e[0].address_components[o].short_name);a({country:i})}else a({country:null});else a({country:null})})}else a({country:null})})}},{key:"_fetchNearestRegions",value:function(e){return this.network.fetch("GET","/region/bylocation/"+e.coords.latitude+"/"+e.coords.longitude)}},{key:"_handleRegions",value:function(a,e){var r=this;e&&0<e.length&&e.forEach(function(e){var t=localStorage.getItem("notificareRegions")?JSON.parse(localStorage.getItem("notificareRegions")):[],o={latitude:a.latitude,longitude:a.longitude},n={latitude:e.geometry.coordinates[1],longitude:e.geometry.coordinates[0]};r.core.distanceBetweenPoints(o,n)<=e.distance?t.indexOf(e._id)<0&&r._executeTrigger("re.notifica.trigger.region.Enter",e).then(function(e){t.push(e._id),localStorage.setItem("notificareRegions",JSON.stringify(t))}):-1<t.indexOf(e._id)&&r._executeTrigger("re.notifica.trigger.region.Exit",e).then(function(e){t.splice(i,1),localStorage.setItem("notificareRegions",JSON.stringify(t))})})}},{key:"_executeTrigger",value:function(e,t){return this.network.fetch("POST","/trigger/"+e,!0,{region:t._id,deviceID:this.deviceManager.device.deviceID})}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareInboxManager=function(){function t(e){_classCallCheck(this,t),this.options=e,this.network=new NotificareNetwork(this.options),this.eventLogger=new NotificareEventLogger(this.options),this.badge=localStorage.getItem("notificareBadge")?localStorage.getItem("notificareBadge"):0,this.didUpdateBadge=null}return _createClass(t,[{key:"myBadge",value:function(){return this.badge}},{key:"fetchInbox",value:function(t,i,o){var a=this,e=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null;if(e&&e.inboxConfig&&e.inboxConfig.useInbox){var r=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;return r&&r.deviceID?new Promise(function(n,e){a.network.fetch("GET","/notification/inbox/fordevice/"+encodeURIComponent(r.deviceID),!0,{since:t,skip:i,limit:o}).then(function(e){var t=[],i=0,o=0;e&&(i=e.count,o=e.unread,e.inboxItems&&0<e.inboxItems.length&&e.inboxItems.forEach(function(e){e.visible&&(!e.expires||new Date(e.expires).getTime()>(new Date).getTime())&&t.push(e)})),n({unread:o,count:i,inboxItems:t})}).catch(function(){n({unread:0,count:0,inboxItems:[]})})}):Promise.reject(new Error("No device token found"))}return Promise.reject(new Error("Inbox not enabled. Please activate it in Settings > Services > Inbox"))}},{key:"openInboxItem",value:function(e){var t=this,i=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null;return i&&i.inboxConfig&&i.inboxConfig.useInbox?Promise.all([this.network.fetch("GET","/notification/"+e._id),this.eventLogger.event("re.notifica.event.notification.Open",{notification:e.notification})]).then(function(e){return t.refreshBadge(),e[0].notification}):Promise.reject(new Error("Inbox not enabled. Please activate it in Settings > Services > Inbox"))}},{key:"markAsRead",value:function(e){var t=this,i=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null;return i&&i.inboxConfig&&i.inboxConfig.useInbox?Promise.all([this.eventLogger.event("re.notifica.event.notification.Open",{notification:e.notification})]).then(function(){return t.refreshBadge(),e}):Promise.reject(new Error("Inbox not enabled. Please activate it in Settings > Services > Inbox"))}},{key:"markAllAsRead",value:function(){var e=this,t=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null;if(t&&t.inboxConfig&&t.inboxConfig.useInbox){var i=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;return i&&i.deviceID?Promise.all([this.network.fetch("PUT","/notification/inbox/fordevice/"+encodeURIComponent(i.deviceID))]).then(function(){return e.refreshBadge(),e.fetchInbox(null,null,null)}):Promise.reject(new Error("No device token found"))}return Promise.reject(new Error("Inbox not enabled. Please activate it in Settings > Services > Inbox"))}},{key:"removeFromInbox",value:function(e){var t=this,i=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null;return i&&i.inboxConfig&&i.inboxConfig.useInbox?Promise.all([this.network.fetch("DELETE","/notification/inbox/"+e._id)]).then(function(){return t.refreshBadge(),e}):Promise.reject(new Error("Inbox not enabled. Please activate it in Settings > Services > Inbox"))}},{key:"clearInbox",value:function(){var e=this,t=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null;if(t&&t.inboxConfig&&t.inboxConfig.useInbox){var i=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;return i&&i.deviceID?Promise.all([this.network.fetch("DELETE","/notification/inbox/fordevice/"+encodeURIComponent(i.deviceID))]).then(function(){return e.refreshBadge(),[]}):Promise.reject(new Error("No device token found"))}return Promise.reject(new Error("Inbox not enabled. Please activate it in Settings > Services > Inbox"))}},{key:"refreshBadge",value:function(){var i=this,e=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null;if(e&&e.inboxConfig&&e.inboxConfig.useInbox&&e.inboxConfig.autoBadge){var t=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;t&&t.deviceID&&this.network.fetch("GET","/notification/inbox/fordevice/"+encodeURIComponent(t.deviceID),!0,{since:null,skip:0,limit:1}).then(function(e){var t=e.unread;localStorage.setItem("notificareBadge",t&&0<t?t:0),i.badge=localStorage.getItem("notificareBadge")?localStorage.getItem("notificareBadge"):0,"function"==typeof i.didUpdateBadge&&i.didUpdateBadge(i.badge),navigator.setClientBadge&&navigator.setClientBadge(t),navigator.setAppBadge&&navigator.setAppBadge(t)})}}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareLoyalty=function(){function t(e){_classCallCheck(this,t),this.options=e,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options)}return _createClass(t,[{key:"fetchPassWithSerial",value:function(e){return this.network.fetch("GET","/pass/forserial/"+e)}},{key:"fetchPassWithBarcode",value:function(e){return this.network.fetch("GET","/pass/forbarcode/"+e)}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareMessageUI=function(){function i(e){var t=this;_classCallCheck(this,i),this.options=e,this.didClickAction=null,this.MESSAGE_UI_CONSTANTS={body:document.getElementsByTagName("BODY")[0],modal:document.createElement("div"),backdrop:document.createElement("div"),iconArea:document.createElement("div"),icon:document.createElement("img"),appName:document.createElement("p"),contentArea:document.createElement("div"),title:document.createElement("p"),subtitle:document.createElement("p"),message:document.createElement("p"),actionsArea:document.createElement("div"),closeButton:document.createElement("a")},document.getElementById("notificareRebootUI").innerHTML=".notificareModalNotification, .notificareModalNotification *, .notificareModalNotification *:after, .notificareModalNotification *:before, .notificareModal, .notificareModal *, .notificareModal *:after, .notificareModal *:before, .notificareFloatingButton, .notificareFloatingButton *, .notificareFloatingButton *:after, .notificareFloatingButton *:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}",this.MESSAGE_UI_CONSTANTS.contentArea.className="ntcContentArea",this.MESSAGE_UI_CONSTANTS.actionsArea.className="ntcActionsArea",this.MESSAGE_UI_CONSTANTS.backdrop.style.position="fixed",this.MESSAGE_UI_CONSTANTS.backdrop.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this.MESSAGE_UI_CONSTANTS.backdrop.style.display="flex",this.MESSAGE_UI_CONSTANTS.backdrop.style.alignItems="center",this.MESSAGE_UI_CONSTANTS.backdrop.style.justifyContent="center",this.MESSAGE_UI_CONSTANTS.backdrop.style.background="rgba(0, 0, 0, .5)",this.MESSAGE_UI_CONSTANTS.backdrop.style.top="0px",this.MESSAGE_UI_CONSTANTS.backdrop.style.bottom="0px",this.MESSAGE_UI_CONSTANTS.backdrop.style.left="0px",this.MESSAGE_UI_CONSTANTS.backdrop.style.right="0px",this.MESSAGE_UI_CONSTANTS.backdrop.style.overflow="hidden",this.MESSAGE_UI_CONSTANTS.backdrop.style.zIndex="2147483647",this.MESSAGE_UI_CONSTANTS.backdrop.className="notificareModalNotification",this.MESSAGE_UI_CONSTANTS.modal.style.position="fixed",this.MESSAGE_UI_CONSTANTS.modal.style.padding="15px",this.MESSAGE_UI_CONSTANTS.modal.style.background="rgb(255, 255, 255)",this.MESSAGE_UI_CONSTANTS.modal.style.width="90vw",this.MESSAGE_UI_CONSTANTS.modal.style.maxWidth="900px",this.MESSAGE_UI_CONSTANTS.modal.style.boxShadow="0px 0px 29px -8px rgba(0,0,0,0.52)",this.MESSAGE_UI_CONSTANTS.modal.style.borderRadius="5px",this.MESSAGE_UI_CONSTANTS.modal.className="ntcModal",this.MESSAGE_UI_CONSTANTS.iconArea.style.width="100%",this.MESSAGE_UI_CONSTANTS.iconArea.style.height="30px",this.MESSAGE_UI_CONSTANTS.iconArea.className="ntcIconArea",this.MESSAGE_UI_CONSTANTS.icon.style.width="20px",this.MESSAGE_UI_CONSTANTS.icon.style.borderRadius="5px",this.MESSAGE_UI_CONSTANTS.icon.style.float="left",this.MESSAGE_UI_CONSTANTS.icon.style.marginRight="10px",this.MESSAGE_UI_CONSTANTS.appName.innerHTML="App Name",this.MESSAGE_UI_CONSTANTS.appName.style.margin="0",this.MESSAGE_UI_CONSTANTS.appName.style.fontSize="14px",this.MESSAGE_UI_CONSTANTS.appName.style.fontWeight="bolder",this.MESSAGE_UI_CONSTANTS.appName.style.lineHeight="1.2",this.MESSAGE_UI_CONSTANTS.appName.className="ntcAppName",this.MESSAGE_UI_CONSTANTS.iconArea.appendChild(this.MESSAGE_UI_CONSTANTS.icon),this.MESSAGE_UI_CONSTANTS.iconArea.appendChild(this.MESSAGE_UI_CONSTANTS.appName),this.MESSAGE_UI_CONSTANTS.closeButton.style.position="absolute",this.MESSAGE_UI_CONSTANTS.closeButton.style.top="0px",this.MESSAGE_UI_CONSTANTS.closeButton.style.right="5px",this.MESSAGE_UI_CONSTANTS.closeButton.style.cursor="pointer",this.MESSAGE_UI_CONSTANTS.closeButton.style.fontSize="20px",this.MESSAGE_UI_CONSTANTS.closeButton.style.color="black",this.MESSAGE_UI_CONSTANTS.closeButton.style.textDecoration="none",this.MESSAGE_UI_CONSTANTS.closeButton.innerHTML="&times;",this.MESSAGE_UI_CONSTANTS.closeButton.style.lineHeight="1.2",this.MESSAGE_UI_CONSTANTS.closeButton.style.border="none",this.MESSAGE_UI_CONSTANTS.closeButton.className="ntcCloseButton",this.MESSAGE_UI_CONSTANTS.title.style.margin="0",this.MESSAGE_UI_CONSTANTS.title.style.fontSize="14px",this.MESSAGE_UI_CONSTANTS.title.style.fontWeight="bolder",this.MESSAGE_UI_CONSTANTS.title.style.lineHeight="1.2",this.MESSAGE_UI_CONSTANTS.title.style.wordBreak="break-all",this.MESSAGE_UI_CONSTANTS.title.className="ntcTitle",this.MESSAGE_UI_CONSTANTS.subtitle.style.margin="0",this.MESSAGE_UI_CONSTANTS.subtitle.style.fontSize="14px",this.MESSAGE_UI_CONSTANTS.subtitle.style.fontWeight="bolder",this.MESSAGE_UI_CONSTANTS.subtitle.style.lineHeight="1.2",this.MESSAGE_UI_CONSTANTS.subtitle.style.wordBreak="break-all",this.MESSAGE_UI_CONSTANTS.subtitle.className="ntcSubtitle",this.MESSAGE_UI_CONSTANTS.message.style.margin="0",this.MESSAGE_UI_CONSTANTS.message.style.fontSize="14px",this.MESSAGE_UI_CONSTANTS.message.style.lineHeight="1.2",this.MESSAGE_UI_CONSTANTS.message.style.wordBreak="break-all",this.MESSAGE_UI_CONSTANTS.message.className="ntcMessage",this.MESSAGE_UI_CONSTANTS.modal.appendChild(this.MESSAGE_UI_CONSTANTS.iconArea),this.MESSAGE_UI_CONSTANTS.modal.appendChild(this.MESSAGE_UI_CONSTANTS.closeButton),this.MESSAGE_UI_CONSTANTS.modal.appendChild(this.MESSAGE_UI_CONSTANTS.contentArea),this.MESSAGE_UI_CONSTANTS.modal.appendChild(this.MESSAGE_UI_CONSTANTS.actionsArea),this.MESSAGE_UI_CONSTANTS.backdrop.appendChild(this.MESSAGE_UI_CONSTANTS.modal),this.MESSAGE_UI_CONSTANTS.closeButton.addEventListener("click",function(){t.MESSAGE_UI_CONSTANTS.backdrop.remove()})}return _createClass(i,[{key:"show",value:function(e,i){var o=this;if(this.MESSAGE_UI_CONSTANTS.backdrop.remove(),this.MESSAGE_UI_CONSTANTS.icon.setAttribute("src",this.options.awsStorage+e.websitePushConfig.icon),this.MESSAGE_UI_CONSTANTS.appName.innerHTML=e.name,this.MESSAGE_UI_CONSTANTS.contentArea.innerHTML="",this.MESSAGE_UI_CONSTANTS.actionsArea.innerHTML="",this.MESSAGE_UI_CONSTANTS.actionsArea.style.margin="0",this.MESSAGE_UI_CONSTANTS.modal.style.width="90vw","re.notifica.notification.Alert"===i.type){if(i.attachments&&0<i.attachments.length&&i.attachments[0]&&i.attachments[0].mimeType&&/image/.test(i.attachments[0].mimeType)){var t=i.attachments[0].uri,n=document.createElement("img");n.setAttribute("src",t),n.style.maxWidth="100%",n.className="ntcAttachment",this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(n)}this.MESSAGE_UI_CONSTANTS.title.innerHTML=i.title?i.title:"",this.MESSAGE_UI_CONSTANTS.subtitle.innerHTML=i.subtitle?i.subtitle:"",this.MESSAGE_UI_CONSTANTS.message.innerHTML=i.message,this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(this.MESSAGE_UI_CONSTANTS.title),this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(this.MESSAGE_UI_CONSTANTS.subtitle),this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(this.MESSAGE_UI_CONSTANTS.message),this.MESSAGE_UI_CONSTANTS.modal.style.width="315px",this.MESSAGE_UI_CONSTANTS.body.appendChild(this.MESSAGE_UI_CONSTANTS.backdrop)}else if("re.notifica.notification.WebView"===i.type){var a=i.content&&0<i.content.length?i.content[0].data:"",r=document.createElement("iframe");r.style.width="100%",r.style.border="none",r.setAttribute("srcdoc",'<!DOCTYPE html><html><head><title></title><meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0"></head><body>'+a+"</body></html>"),r.className="ntcWebView",this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(r),this.MESSAGE_UI_CONSTANTS.body.appendChild(this.MESSAGE_UI_CONSTANTS.backdrop),r.addEventListener("load",function(e){var t=e.target,i="contentDocument"in t?t.contentDocument.body.offsetHeight+32+"px":t.contentWindow.document.body.offsetHeight+32+"px";t.style.height=0,t.style.height=i},!0)}else if("re.notifica.notification.URL"===i.type){var s=i.content&&0<i.content.length?i.content[0].data:"",c=document.createElement("iframe");c.style.width="100%",c.style.height="75vh",c.style.border="none",c.setAttribute("src",s),c.className="ntcURL",this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(c),this.MESSAGE_UI_CONSTANTS.body.appendChild(this.MESSAGE_UI_CONSTANTS.backdrop)}else if("re.notifica.notification.URLScheme"===i.type){var l=i.content&&0<i.content.length?i.content[0].data:null;l&&(window.location.href=l)}else if("re.notifica.notification.Passbook"===i.type){var u=i.content&&0<i.content.length?i.content[0].data:"",d=document.createElement("iframe");d.style.width="100%",d.style.height="75vh",d.style.border="none",d.setAttribute("src",u),d.className="ntcPassbook",this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(d),this.MESSAGE_UI_CONSTANTS.body.appendChild(this.MESSAGE_UI_CONSTANTS.backdrop)}else if("re.notifica.notification.Map"===i.type){var p=document.createElement("div");if(p.style.width="100%",p.style.height="75vh",p.className="ntcMap",this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(p),this.MESSAGE_UI_CONSTANTS.body.appendChild(this.MESSAGE_UI_CONSTANTS.backdrop),i.content&&0<i.content.length)if("undefined"!=typeof google&&google&&google.maps){var f=new google.maps.Map(p,{zoom:4,center:new google.maps.LatLng(i.content[0].data.latitude,i.content[0].data.longitude)}),h=[];i.content.forEach(function(e){var t=new google.maps.Marker({position:new google.maps.LatLng(e.data.latitude,e.data.longitude),map:f});h.push(t);var i='<h2 style="margin: 0; line-height: 1.2; font-size: 18px; font-weight: bolder;">'+e.data.title+'</h2><p style="margin: 0; line-height: 1.2; font-size: 14px;">'+e.data.description+"</p>",o=new google.maps.InfoWindow({content:i});google.maps.event.addListener(t,"click",function(){o.open(f,t)})});var N=new google.maps.LatLngBounds;h.forEach(function(e){N.extend(e.getPosition())}),f.fitBounds(N)}else console.warn('Notificare: Missing Google Maps. Please add <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"><\/script> just before your </body>')}else if("re.notifica.notification.Video"===i.type){var S,g=i.content&&0<i.content.length?i.content[0].type:null,y=i.content&&0<i.content.length?i.content[0].data:null;g&&"re.notifica.content.YouTube"===g?S='<iframe class=\'video youtube\' width="560" height="349" src="https://www.youtube.com/embed/'+y+'?rel=0&hd=1" frameborder="0" allowfullscreen></iframe>':g&&"re.notifica.content.Vimeo"===g?S="<iframe class='video vimeo' src='https://player.vimeo.com/video/"+y+"?autoplay=1' width='100%' height='395' frameborder='0' webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>":g&&"re.notifica.content.HTML5Video"===g&&(S="<video class='video html5' width='100%' height='395' autoplay controls preload><source src='"+y+"' type='video/mp4'></video>");var T='<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0"><style>body{margin:0px 0px 0px 0px;}#player{position: relative;padding-bottom: 56.25%;padding-top: 25px;height: 0;}#player .video{position: absolute;top: 0;left: 0;width: 100%;height: 100%;background: black;}</style></head><body><div id=\'player\'>'+S+"</div></body></html>",v=document.createElement("iframe");v.style.width="100%",v.style.border="none",v.setAttribute("srcdoc",T),v.className="ntcVideo",v.addEventListener("load",function(e){var t=e.target,i="contentDocument"in t?t.contentDocument.body.offsetHeight:t.contentWindow.document.body.offsetHeight;t.style.height=0,t.style.height=i+"px"},!0),this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(v),this.MESSAGE_UI_CONSTANTS.body.appendChild(this.MESSAGE_UI_CONSTANTS.backdrop)}else if("re.notifica.notification.Image"===i.type){var m=document.createElement("div"),_=document.createElement("div");m.style.width="100%",m.style.height="75vh",m.style.overflow="auto hidden",m.className="ntcImage",_.style.display="flex",_.style.alignItems="center",_.style.justifyContent="center",_.style.height="100%",i.content&&0<i.content.length&&(i.content.forEach(function(e){var t=document.createElement("img");t.setAttribute("src",e.data),_.appendChild(t)}),m.appendChild(_),this.MESSAGE_UI_CONSTANTS.contentArea.appendChild(m)),this.MESSAGE_UI_CONSTANTS.body.appendChild(this.MESSAGE_UI_CONSTANTS.backdrop);var O=_.childNodes;_.style.width=m.offsetWidth*i.content.length+"px",O.forEach(function(e){e.style.width=m.offsetWidth+"px"})}i.actions&&0<i.actions.length&&(this.MESSAGE_UI_CONSTANTS.actionsArea.style.margin="10px 0 0 0",i.actions.forEach(function(e){var t=document.createElement("a");t.style.display="block",t.style.fontSize="12px",t.style.textAlign="center",t.style.background="white",t.style.border="2px solid black",t.style.padding="10px",t.style.marginTop="5px",t.href="#",t.style.textDecoration="none",t.style.color="black",t.style.fontWeight="bolder",t.dataset.label=e.label,t.innerHTML=e.label,t.className="ntcAction",o.MESSAGE_UI_CONSTANTS.actionsArea.appendChild(t),t.addEventListener("click",function(e){e.preventDefault(),o.MESSAGE_UI_CONSTANTS.backdrop.remove(),o.didClickAction(i,e.target.dataset.label)})}))}},{key:"hide",value:function(){this.MESSAGE_UI_CONSTANTS.backdrop.remove()}}]),i}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareNetwork=function(){function t(e){_classCallCheck(this,t),this.options=e,this.core=new NotificareCore,this.headers={accept:"application/json",contentType:"application/json; charset=utf-8"}}function e(e,t,i,o,n){return a.apply(this,arguments)}var a;return _createClass(t,[{key:"fetch",value:(a=function(e,t,i,o,n){var a=new window.Headers,r=this.options.apiUrl+t,s={credentials:"include",method:e,mode:"cors"},c=this.core.deviceLanguage(),l=this.core.deviceRegion();localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(c=localStorage.getItem("notificarePreferredLanguage"),l=localStorage.getItem("notificarePreferredRegion")),a.append("Accept-Language",c+"-"+l),n||(a.append("Accept",this.headers.accept),a.append("Content-Type",this.headers.contentType)),!i&&void 0!==i||a.append("Authorization","Basic "+btoa(this.options.appKey+":"+this.options.appSecret)),s.headers=a,o&&("GET"===e||"DELETE"===e?r=r+"?"+Object.keys(o).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(o[e])}).join("&"):"POST"!==e&&"PUT"!==e||(s.body=n?o:JSON.stringify(o)));return fetch(r,s).then(function(e){return e.ok?e:Promise.reject(e)}).then(function(e){return e.text()}).then(function(e){return e?JSON.parse(e):null})},e.toString=function(){return a.toString()},e)}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareOnBoarding=function(){function t(e){_classCallCheck(this,t),this.options=e,this.didOpenNotificationPermission=null,this.didCancelOnBoarding=null,this.ONBOARDING_UI_CONSTANTS={body:document.getElementsByTagName("BODY")[0],modal:document.createElement("div"),backdrop:document.createElement("div"),iconArea:document.createElement("div"),icon:document.createElement("img"),textArea:document.createElement("div"),appName:document.createElement("p"),text:document.createElement("p"),cancelButton:document.createElement("a"),acceptButton:document.createElement("a"),branding:document.createElement("div"),brandingLink:document.createElement("a"),brandingIcon:document.createElement("img"),brandingText:document.createElement("p")},document.getElementById("notificareRebootUI").innerHTML=".notificareModalNotification, .notificareModalNotification *, .notificareModalNotification *:after, .notificareModalNotification *:before, .notificareModal, .notificareModal *, .notificareModal *:after, .notificareModal *:before, .notificareFloatingButton, .notificareFloatingButton *, .notificareFloatingButton *:after, .notificareFloatingButton *:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}",this.ONBOARDING_UI_CONSTANTS.backdrop.style.position="fixed",this.ONBOARDING_UI_CONSTANTS.backdrop.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this.ONBOARDING_UI_CONSTANTS.backdrop.style.display="flex",this.ONBOARDING_UI_CONSTANTS.backdrop.style.alignItems="start",this.ONBOARDING_UI_CONSTANTS.backdrop.style.justifyContent="center",this.ONBOARDING_UI_CONSTANTS.backdrop.style.background="rgba(0, 0, 0, .5)",this.ONBOARDING_UI_CONSTANTS.backdrop.style.top="0px",this.ONBOARDING_UI_CONSTANTS.backdrop.style.bottom="0px",this.ONBOARDING_UI_CONSTANTS.backdrop.style.left="0px",this.ONBOARDING_UI_CONSTANTS.backdrop.style.right="0px",this.ONBOARDING_UI_CONSTANTS.backdrop.style.overflow="hidden",this.ONBOARDING_UI_CONSTANTS.backdrop.style.zIndex="2147483647",this.ONBOARDING_UI_CONSTANTS.backdrop.className="notificareModal",this.ONBOARDING_UI_CONSTANTS.modal.style.position="fixed",this.ONBOARDING_UI_CONSTANTS.modal.style.marginTop="50px",this.ONBOARDING_UI_CONSTANTS.modal.style.padding="15px",this.ONBOARDING_UI_CONSTANTS.modal.style.background="rgb(255, 255, 255)",this.ONBOARDING_UI_CONSTANTS.modal.style.width="315px",this.ONBOARDING_UI_CONSTANTS.modal.style.minHeight="180px",this.ONBOARDING_UI_CONSTANTS.modal.style.boxShadow="0px 0px 29px -8px rgba(0,0,0,0.52)",this.ONBOARDING_UI_CONSTANTS.modal.style.borderRadius="5px",this.ONBOARDING_UI_CONSTANTS.modal.className="ntcModal",this.ONBOARDING_UI_CONSTANTS.iconArea.style.position="absolute",this.ONBOARDING_UI_CONSTANTS.iconArea.className="ntcIconArea",this.ONBOARDING_UI_CONSTANTS.icon.style.width="60px",this.ONBOARDING_UI_CONSTANTS.icon.style.borderRadius="10px",this.ONBOARDING_UI_CONSTANTS.textArea.style.position="absolute",this.ONBOARDING_UI_CONSTANTS.textArea.style.left="90px",this.ONBOARDING_UI_CONSTANTS.textArea.style.right="15px",this.ONBOARDING_UI_CONSTANTS.textArea.className="ntcTextArea",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.position="absolute",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.width="80px",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.fontSize="12px",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.textAlign="center",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.padding="10px 5px 10px 5px",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.right="105px",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.bottom="15px",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.background="#EAEAEA",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.border="2px solid white",this.ONBOARDING_UI_CONSTANTS.cancelButton.innerHTML="No",this.ONBOARDING_UI_CONSTANTS.cancelButton.href="#",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.textDecoration="none",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.color="black",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.textTransform="uppercase",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.fontWeight="bolder",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.whiteSpace="nowrap",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.overflow="hidden",this.ONBOARDING_UI_CONSTANTS.cancelButton.style.textOverflow="ellipsis",this.ONBOARDING_UI_CONSTANTS.cancelButton.className="ntcCancelButton",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.position="absolute",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.width="80px",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.fontSize="12px",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.textAlign="center",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.background="white",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.border="2px solid black",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.padding="10px 5px 10px 5px",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.right="15px",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.bottom="15px",this.ONBOARDING_UI_CONSTANTS.acceptButton.innerHTML="Yes",this.ONBOARDING_UI_CONSTANTS.acceptButton.href="#",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.textDecoration="none",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.color="black",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.textTransform="uppercase",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.fontWeight="bolder",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.whiteSpace="nowrap",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.overflow="hidden",this.ONBOARDING_UI_CONSTANTS.acceptButton.style.textOverflow="ellipsis",this.ONBOARDING_UI_CONSTANTS.acceptButton.className="ntcAcceptButton",this.ONBOARDING_UI_CONSTANTS.text.innerHTML="Would you like to receive web push notifications from our website?",this.ONBOARDING_UI_CONSTANTS.text.style.margin="0",this.ONBOARDING_UI_CONSTANTS.text.style.fontSize="14px",this.ONBOARDING_UI_CONSTANTS.text.style.lineHeight="1.2",this.ONBOARDING_UI_CONSTANTS.text.className="ntcText",this.ONBOARDING_UI_CONSTANTS.appName.innerHTML="App Name",this.ONBOARDING_UI_CONSTANTS.appName.style.margin="0",this.ONBOARDING_UI_CONSTANTS.appName.style.fontSize="20px",this.ONBOARDING_UI_CONSTANTS.appName.style.fontWeight="bolder",this.ONBOARDING_UI_CONSTANTS.appName.style.lineHeight="1.2",this.ONBOARDING_UI_CONSTANTS.appName.className="ntcAppName",this.ONBOARDING_UI_CONSTANTS.textArea.appendChild(this.ONBOARDING_UI_CONSTANTS.appName),this.ONBOARDING_UI_CONSTANTS.textArea.appendChild(this.ONBOARDING_UI_CONSTANTS.text),this.ONBOARDING_UI_CONSTANTS.iconArea.appendChild(this.ONBOARDING_UI_CONSTANTS.icon),this.ONBOARDING_UI_CONSTANTS.brandingIcon.setAttribute("src","https://cdn.notifica.re/libs/html5/v2/assets/logo.svg"),this.ONBOARDING_UI_CONSTANTS.brandingIcon.style.width="80px",this.ONBOARDING_UI_CONSTANTS.brandingIcon.style.height="17px",this.ONBOARDING_UI_CONSTANTS.brandingIcon.style.verticalAlign="baseline",this.ONBOARDING_UI_CONSTANTS.brandingIcon.style.border="none",this.ONBOARDING_UI_CONSTANTS.brandingLink.href="https://notificare.com",this.ONBOARDING_UI_CONSTANTS.brandingLink.target="_blank",this.ONBOARDING_UI_CONSTANTS.brandingLink.style.border="none",this.ONBOARDING_UI_CONSTANTS.brandingLink.style.textDecoration="none",this.ONBOARDING_UI_CONSTANTS.brandingText.innerHTML="powered by",this.ONBOARDING_UI_CONSTANTS.brandingText.style.lineHeight="1.2",this.ONBOARDING_UI_CONSTANTS.brandingText.style.fontSize="8px",this.ONBOARDING_UI_CONSTANTS.brandingText.style.margin="0",this.ONBOARDING_UI_CONSTANTS.branding.style.position="absolute",this.ONBOARDING_UI_CONSTANTS.branding.style.left="15px",this.ONBOARDING_UI_CONSTANTS.branding.style.bottom="15px",this.ONBOARDING_UI_CONSTANTS.brandingLink.appendChild(this.ONBOARDING_UI_CONSTANTS.brandingIcon),this.ONBOARDING_UI_CONSTANTS.branding.appendChild(this.ONBOARDING_UI_CONSTANTS.brandingText),this.ONBOARDING_UI_CONSTANTS.branding.appendChild(this.ONBOARDING_UI_CONSTANTS.brandingLink),this.ONBOARDING_UI_CONSTANTS.modal.appendChild(this.ONBOARDING_UI_CONSTANTS.branding),this.ONBOARDING_UI_CONSTANTS.modal.appendChild(this.ONBOARDING_UI_CONSTANTS.iconArea),this.ONBOARDING_UI_CONSTANTS.modal.appendChild(this.ONBOARDING_UI_CONSTANTS.textArea),this.ONBOARDING_UI_CONSTANTS.modal.appendChild(this.ONBOARDING_UI_CONSTANTS.cancelButton),this.ONBOARDING_UI_CONSTANTS.modal.appendChild(this.ONBOARDING_UI_CONSTANTS.acceptButton),this.ONBOARDING_UI_CONSTANTS.backdrop.appendChild(this.ONBOARDING_UI_CONSTANTS.modal)}return _createClass(t,[{key:"show",value:function(e,t){var i=this;e.branding||this.ONBOARDING_UI_CONSTANTS.branding.remove(),this.ONBOARDING_UI_CONSTANTS.appName.innerHTML=e.name,this.ONBOARDING_UI_CONSTANTS.text.innerHTML=t.text,this.ONBOARDING_UI_CONSTANTS.acceptButton.innerHTML=t.acceptText,this.ONBOARDING_UI_CONSTANTS.cancelButton.innerHTML=t.cancelText,this.ONBOARDING_UI_CONSTANTS.icon.setAttribute("src",this.options.awsStorage+e.websitePushConfig.icon),this.ONBOARDING_UI_CONSTANTS.body.appendChild(this.ONBOARDING_UI_CONSTANTS.backdrop),this.ONBOARDING_UI_CONSTANTS.acceptButton.addEventListener("click",function(e){e.preventDefault(),i.didOpenNotificationPermission()}),this.ONBOARDING_UI_CONSTANTS.cancelButton.addEventListener("click",function(e){e.preventDefault(),i.didCancelOnBoarding()})}},{key:"hide",value:function(){this.ONBOARDING_UI_CONSTANTS.backdrop.remove()}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificarePush=function(){function t(e){_classCallCheck(this,t),this.options=e,this.core=new NotificareCore,this.eventLogger=new NotificareEventLogger(this.options),this.network=new NotificareNetwork(this.options),this.application=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null,this.device=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null,this.serviceWorkerRegistration=null,"serviceWorker"in navigator&&(navigator.serviceWorker.onmessage=this._handlePushWorkerMessages.bind(this)),this.didActivateWorker=null,this.didUnsubscribePushRegistration=null,this.didReceiveNotification=null,this.didClickNotification=null,this.didClickReplyInNotification=null,this.didReceiveSystemNotification=null,this.didReceiveWorkerPush=null,this.didReceiveWorkerUnknownPush=null,this.willExecuteAction=null,this.didExecuteAction=null,this.didNotExecuteAction=null,this.didFailToExecuteAction=null,this.shouldPerformActionWithURL=null,this.isReady=!1,this.UI_CONSTANTS={body:document.getElementsByTagName("BODY")[0],canvas:document.createElement("canvas"),textarea:document.createElement("textarea"),video:document.createElement("video"),next:document.createElement("a"),send:document.createElement("a"),cancel:document.createElement("a"),close:document.createElement("a"),button:document.createElement("a"),modal:document.createElement("div"),bg:document.createElement("div")},document.getElementById("notificareRebootUI").innerHTML=".notificareModalNotification, .notificareModalNotification *, .notificareModalNotification *:after, .notificareModalNotification *:before, .notificareModal, .notificareModal *, .notificareModal *:after, .notificareModal *:before, .notificareFloatingButton, .notificareFloatingButton *, .notificareFloatingButton *:after, .notificareFloatingButton *:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}",this.UI_CONSTANTS.context=this.UI_CONSTANTS.canvas.getContext("2d"),this.UI_CONSTANTS.textarea.style.width="100%",this.UI_CONSTANTS.textarea.style.height="300px",this.UI_CONSTANTS.textarea.style.border="2px solid black",this.UI_CONSTANTS.textarea.style.outline="0",this.UI_CONSTANTS.textarea.style.fontSize="14px",this.UI_CONSTANTS.textarea.style.color="black",this.UI_CONSTANTS.textarea.style.padding="5px",this.UI_CONSTANTS.textarea.style.margin="10px 0 0 0",this.UI_CONSTANTS.textarea.setAttribute("placeholder",this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.keyboard?this.options.UI.text.keyboard:"Type a reply"),this.UI_CONSTANTS.canvas.style.display="block",this.UI_CONSTANTS.canvas.style.margin="10px 0 0 0",this.UI_CONSTANTS.video.style.display="block",this.UI_CONSTANTS.video.style.width="100%",this.UI_CONSTANTS.video.style.margin="10px 0 0 0",this.UI_CONSTANTS.next.style.display="block",this.UI_CONSTANTS.next.style.fontSize="12px",this.UI_CONSTANTS.next.style.textAlign="center",this.UI_CONSTANTS.next.style.background="white",this.UI_CONSTANTS.next.style.border="2px solid black",this.UI_CONSTANTS.next.style.padding="10px",this.UI_CONSTANTS.next.style.marginTop="5px",this.UI_CONSTANTS.next.href="#",this.UI_CONSTANTS.next.style.textDecoration="none",this.UI_CONSTANTS.next.style.color="black",this.UI_CONSTANTS.next.style.fontWeight="bolder",this.UI_CONSTANTS.next.innerHTML=this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.next?this.options.UI.text.next:"Next",this.UI_CONSTANTS.send.style.display="block",this.UI_CONSTANTS.send.style.fontSize="12px",this.UI_CONSTANTS.send.style.textAlign="center",this.UI_CONSTANTS.send.style.background="white",this.UI_CONSTANTS.send.style.border="2px solid black",this.UI_CONSTANTS.send.style.padding="10px",this.UI_CONSTANTS.send.style.marginTop="5px",this.UI_CONSTANTS.send.href="#",this.UI_CONSTANTS.send.style.textDecoration="none",this.UI_CONSTANTS.send.style.color="black",this.UI_CONSTANTS.send.style.fontWeight="bolder",this.UI_CONSTANTS.send.innerHTML=this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.send?this.options.UI.text.send:"Send",this.UI_CONSTANTS.cancel.style.position="absolute",this.UI_CONSTANTS.cancel.style.top="-4px",this.UI_CONSTANTS.cancel.style.right="5px",this.UI_CONSTANTS.cancel.style.cursor="pointer",this.UI_CONSTANTS.cancel.style.fontSize="24px",this.UI_CONSTANTS.cancel.style.color="black",this.UI_CONSTANTS.cancel.style.textDecoration="none",this.UI_CONSTANTS.cancel.style.lineHeight="1.2",this.UI_CONSTANTS.cancel.innerHTML="&times;",this.UI_CONSTANTS.close.style.position="absolute",this.UI_CONSTANTS.close.style.top="-4px",this.UI_CONSTANTS.close.style.right="5px",this.UI_CONSTANTS.close.style.cursor="pointer",this.UI_CONSTANTS.close.style.fontSize="24px",this.UI_CONSTANTS.close.style.color="black",this.UI_CONSTANTS.close.style.textDecoration="none",this.UI_CONSTANTS.close.innerHTML="&times;",this.UI_CONSTANTS.button.style.display="block",this.UI_CONSTANTS.button.style.fontSize="12px",this.UI_CONSTANTS.button.style.textAlign="center",this.UI_CONSTANTS.button.style.background="white",this.UI_CONSTANTS.button.style.border="2px solid black",this.UI_CONSTANTS.button.style.padding="10px",this.UI_CONSTANTS.button.style.marginTop="5px",this.UI_CONSTANTS.button.href="#",this.UI_CONSTANTS.button.style.textDecoration="none",this.UI_CONSTANTS.button.style.color="black",this.UI_CONSTANTS.button.style.fontWeight="bolder",this.UI_CONSTANTS.button.innerHTML=this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.camera?this.options.UI.text.camera:"Take Picture",this.UI_CONSTANTS.modal.style.position="fixed",this.UI_CONSTANTS.modal.style.padding="15px",this.UI_CONSTANTS.modal.style.background="rgb(255, 255, 255)",this.UI_CONSTANTS.modal.style.width="90vw",this.UI_CONSTANTS.modal.style.maxWidth="900px",this.UI_CONSTANTS.modal.style.boxShadow="0px 0px 29px -8px rgba(0,0,0,0.52)",this.UI_CONSTANTS.modal.style.borderRadius="5px",this.UI_CONSTANTS.bg.style.position="fixed",this.UI_CONSTANTS.bg.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this.UI_CONSTANTS.bg.style.display="flex",this.UI_CONSTANTS.bg.style.alignItems="center",this.UI_CONSTANTS.bg.style.justifyContent="center",this.UI_CONSTANTS.bg.style.background="rgba(0, 0, 0, .5)",this.UI_CONSTANTS.bg.style.top="0px",this.UI_CONSTANTS.bg.style.bottom="0px",this.UI_CONSTANTS.bg.style.left="0px",this.UI_CONSTANTS.bg.style.right="0px",this.UI_CONSTANTS.bg.style.overflow="hidden",this.UI_CONSTANTS.bg.style.zIndex="2147483647",this.UI_CONSTANTS.bg.className="notificareModalNotification"}return _createClass(t,[{key:"registerForNotifications",value:function(){var r=this;return new Promise(function(o,n){var a=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null,e=!1;if((-1<r.options.appHost.indexOf("localhost")||-1<r.options.appHost.indexOf("https"))&&(e=!0),a.websitePushConfig&&a.websitePushConfig.icon&&0<a.websitePushConfig.allowedDomains.length&&-1<a.websitePushConfig.allowedDomains.indexOf(r.options.fullHost))if("serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window)if(a.websitePushConfig&&a.websitePushConfig.vapid&&a.websitePushConfig.vapid.publicKey&&r.options.serviceWorker)if(e){var t=null;r.options.serviceWorkerScope&&(t={scope:r.options.serviceWorkerScope}),r._registerServiceWorker(r.options.serviceWorker,t).then(function(){navigator.serviceWorker.ready.then(function(i){r.isReady=!0,i.active.postMessage(JSON.stringify({action:"re.notifica.ready"})),(r.serviceWorkerRegistration=i).pushManager.getSubscription().then(function(t){if(t&&t.options&&t.options.applicationServerKey&&r.core.arrayBufferToBase64Url(t.options.applicationServerKey)===a.websitePushConfig.vapid.publicKey)t.expirationTime&&Date.now()>t.expirationTime-432e6?t.unsubscribe().then(function(){i.pushManager.subscribe(subscriptionOptions).then(function(e){o(r.core.getPushToken(e))}).catch(function(e){n(e)})}).catch(function(e){n(e)}):o(r.core.getPushToken(t));else{var e={name:"push",userVisibleOnly:!0};a.websitePushConfig.vapid.publicKey&&(e.applicationServerKey=r.core.base64UrlToUint8Array(a.websitePushConfig.vapid.publicKey)),i.pushManager.subscribe(e).then(function(e){o(r.core.getPushToken(e))}).catch(function(e){t&&t.options&&t.options.applicationServerKey&&r.core.arrayBufferToBase64Url(t.options.applicationServerKey)!=a.websitePushConfig.vapid.publicKey?r.serviceWorkerRegistration.pushManager.getSubscription().then(function(e){if(e)return e.unsubscribe()}).then(function(){n(new Error("Subscription for service worker is no longer valid and has been unsubscribed. Please register again."))}):n(e)})}}).catch(function(e){n(e)})})}).catch(function(e){n(e)})}else n(new Error("Service workers are only available over HTTPS or using localhost."));else n(new Error("Please check your Website Push configurations in our dashboard before proceed. Missing a GCM/FCM Server Key, VAPID or incorrect path and scope to the service worker in config.json."));else if("safari"in window&&"pushNotification"in window.safari&&a.websitePushConfig&&a.websitePushConfig.info&&a.websitePushConfig.info.subject&&a.websitePushConfig.info.subject.UID){var i=window.safari.pushNotification.permission(a.websitePushConfig.info.subject.UID);if("default"==i.permission)try{window.safari.pushNotification.requestPermission(r.options.websitePushUrl,a.websitePushConfig.info.subject.UID,{applicationKey:r.options.appKey},function(e){e.deviceToken?o(e.deviceToken):n(new Error("Not a valid Safari Push Token. Can not proceed."))})}catch(e){n(e)}else"denied"==i.permission?n(i):"granted"==i.permission&&o(i.deviceToken)}else n(new Error(" Your browser does not support Service Workers nor Safari Website Push."));else n(new Error("Please check your Website Push configurations in our dashboard before proceed. Missing the App Icon and Allowed Domains."))})}},{key:"_registerServiceWorker",value:function(n,a){return new Promise(function(i,o){navigator.serviceWorker.getRegistrations().then(function(e){if(e&&0<e.length&&e[0].active){var t=e[0].active.scriptURL;if(new RegExp(n).test(t))return console.warn("Notificare: Using previously registered Service Worker"),void i()}navigator.serviceWorker.register(n,a).then(function(){console.warn("Notificare: Registering new Service Worker"),i()}).catch(function(e){o(e)})})})}},{key:"unregisterForNotifications",value:function(){var e=this;this.device&&"WebPush"===this.device.transport?this.serviceWorkerRegistration.pushManager.getSubscription().then(function(e){if(e)return e.unsubscribe()}).then(function(){e.didUnsubscribePushRegistration()}):"WebsitePush"===this.device.transport&&this.didUnsubscribePushRegistration()}},{key:"_handlePushWorkerMessages",value:function(e){if(this.isReady&&navigator.serviceWorker.ready.then(function(e){e.active.postMessage(JSON.stringify({action:"re.notifica.ready"}))}),e&&e.data){var t=JSON.parse(e.data);switch(t.cmd){case"notificationclick":this.didClickNotification(t.message,t.url);break;case"notificationreceive":this.didReceiveNotification(t.message);break;case"notificationreply":this.didClickReplyInNotification(t.message,t.action,t.bg);break;case"system":this.didReceiveSystemNotification(t.message);break;case"workerpush":this.didReceiveWorkerPush(t.message);break;case"unknownpush":this.didReceiveWorkerUnknownPush(t.message);break;case"activate":"function"==typeof this.didActivateWorker&&this.didActivateWorker()}}}},{key:"openNotification",value:function(e){return Promise.all([this.network.fetch("GET","/notification/"+e),this.eventLogger.event("re.notifica.event.notification.Influenced",{notification:e}),this.eventLogger.event("re.notifica.event.notification.Open",{notification:e})]).then(function(e){return e[0].notification})}},{key:"handleAction",value:function(t,i){var o=this;t&&t.actions&&0<t.actions.length&&t.actions.forEach(function(e){e.label==i&&o._handleActionType(t,e)})}},{key:"_handleActionType",value:function(e,t){if(t){this.willExecuteAction(e,t);var i={};"re.notifica.action.Callback"==t.type?t.camera&&t.keyboard&&!t.target?this._replyWithCameraAndKeyboard(e,t,i):!t.camera||t.keyboard||t.target?t.camera||!t.keyboard||t.target?t.target?this._replyWithTarget(e,t,i):this._handleReply(e,t,null):this._replyWithKeyboard(e,t,i):this._replyWithCamera(e,t,i):"re.notifica.action.Browser"==t.type||"re.notifica.action.App"==t.type||"re.notifica.action.Telephone"==t.type||"re.notifica.action.Mail"==t.type||"re.notifica.action.SMS"==t.type||"re.notifica.action.Custom"==t.type?this._handleReply(e,t,i):this.didFailToExecuteAction(e,t)}}},{key:"_replyWithKeyboard",value:function(t,i,o){var n=this,a=this.UI_CONSTANTS;if(a.bg&&(a.bg.remove(),a.modal)){for(;a.modal.firstChild;)a.modal.removeChild(a.modal.firstChild);a.modal.remove()}a.modal.appendChild(a.textarea),a.modal.appendChild(a.send),a.modal.appendChild(a.close),a.bg.appendChild(a.modal),a.body.appendChild(a.bg),a.textarea.style.display="block",a.textarea.value="",a.send.style.display="block",a.close.style.display="block",a.send.addEventListener("click",function(e){e.preventDefault(),o={message:a.textarea.value},n._handleReply(t,i,o),a.bg.remove()}),a.close.addEventListener("click",function(e){e.preventDefault(),a.bg.remove(),n.didNotExecuteAction(t,i)})}},{key:"_replyWithCamera",value:function(n,a,r){var s=this,c=this.UI_CONSTANTS;if(c.bg&&(c.bg.remove(),c.modal)){for(;c.modal.firstChild;)c.modal.removeChild(c.modal.firstChild);c.modal.remove()}navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:{width:1280,height:720}}).then(function(o){c.video.srcObject=o,c.modal.appendChild(c.video),c.modal.appendChild(c.button),c.modal.appendChild(c.canvas),c.modal.appendChild(c.send),c.modal.appendChild(c.cancel),c.modal.appendChild(c.close),c.bg.appendChild(c.modal),c.body.appendChild(c.bg),c.video.style.display="block",c.canvas.style.display="none",c.send.style.display="none",c.cancel.style.display="none",c.video.style.display="block",c.button.style.display="block",c.close.style.display="block",c.video.play(),c.button.addEventListener("click",function(e){e.preventDefault(),c.canvas.style.width=c.video.offsetWidth+"px",c.canvas.style.height=c.video.offsetHeight+"px",c.context.drawImage(c.video,0,0,c.video.videoWidth,c.video.videoHeight,0,0,c.canvas.width,c.canvas.height),c.video.style.display="none",c.button.style.display="none",c.close.style.display="none",c.canvas.style.display="block",c.send.style.display="block",c.cancel.style.display="block",c.video.srcObject=null,c.video.pause()}),c.send.addEventListener("click",function(e){e.preventDefault();var t=c.canvas.toDataURL("image/jpg"),i=s._dataURItoBlob(t);s._uploadFile(i,"reply").then(function(e){r={media:e},s._handleReply(n,a,r)}),c.video.srcObject=null,c.video.pause(),o.getTracks()[0].stop(),c.bg.remove()}),c.cancel.addEventListener("click",function(e){e.preventDefault(),c.canvas.style.display="none",c.send.style.display="none",c.cancel.style.display="none",c.video.style.display="block",c.button.style.display="block",c.close.style.display="block",c.video.srcObject=o,c.video.play()}),c.close.addEventListener("click",function(e){e.preventDefault(),c.video.srcObject=null,c.video.pause(),o.getTracks()[0].stop(),c.bg.remove(),s.didNotExecuteAction(n,a)})})}},{key:"_replyWithCameraAndKeyboard",value:function(t,i,n){var a=this,r=this.UI_CONSTANTS;if(r.bg&&(r.bg.remove(),r.modal)){for(;r.modal.firstChild;)r.modal.removeChild(r.modal.firstChild);r.modal.remove()}navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(o){r.video.srcObject=o,r.modal.appendChild(r.textarea),r.modal.appendChild(r.video),r.modal.appendChild(r.button),r.modal.appendChild(r.canvas),r.modal.appendChild(r.send),r.modal.appendChild(r.next),r.modal.appendChild(r.cancel),r.modal.appendChild(r.close),r.bg.appendChild(r.modal),r.body.appendChild(r.bg),r.video.play(),r.canvas.style.display="none",r.textarea.style.display="none",r.textarea.value="",r.send.style.display="none",r.cancel.style.display="none",r.next.style.display="none",r.video.style.display="block",r.button.style.display="block",r.close.style.display="block",r.button.addEventListener("click",function(e){e.preventDefault(),r.canvas.style.width=r.video.offsetWidth+"px",r.canvas.style.height=r.video.offsetHeight+"px",r.context.drawImage(r.video,0,0,r.video.videoWidth,r.video.videoHeight,0,0,r.canvas.width,r.canvas.height),r.video.style.display="none",r.button.style.display="none",r.close.style.display="none",r.canvas.style.display="block",r.next.style.display="block",r.cancel.style.display="block",r.send.style.display="none",r.video.srcObject=null,r.video.pause()}),r.next.addEventListener("click",function(e){e.preventDefault();var t=r.canvas.toDataURL("image/jpg"),i=a._dataURItoBlob(t);a._uploadFile(i,"reply").then(function(e){n={media:e},r.textarea.style.display="block",r.send.style.display="block",r.canvas.style.display="none",r.next.style.display="none"}),r.video.srcObject=null,r.video.pause(),o.getTracks()[0].stop()}),r.send.addEventListener("click",function(e){e.preventDefault(),n.message=r.textarea.value,a._handleReply(t,i,n),r.bg.remove()}),r.cancel.addEventListener("click",function(e){e.preventDefault(),r.canvas.style.display="none",r.send.style.display="none",r.cancel.style.display="none",r.next.style.display="none",r.textarea.style.display="none",r.video.style.display="block",r.button.style.display="block",r.close.style.display="block",r.video.srcObject=o,r.video.play()}),r.close.addEventListener("click",function(e){e.preventDefault(),r.video.srcObject=null,r.video.pause(),o.getTracks()[0].stop(),r.bg.remove(),a.didNotExecuteAction(t,i)})})}},{key:"_replyWithTarget",value:function(e,t,i){var o,n,a,r,s=this,c=t.target.split("?");if(1<c.length)for(a=0,r=(o=c[1].split("&")).length;a<r;a++)n=o[a].split("="),i[n[0]]=n[1];i.target=c[0],i.label=t.label,e._id&&(i.notificationID=e._id),this.device.deviceID&&(i.deviceID=this.device.deviceID),this.device.userID&&(i.userID=this.device.userID),this.network.fetch("POST","/reply/webhook",!0,i).then(function(){s._handleReply(e,t,i)})}},{key:"_handleReply",value:function(e,t,i){var o=this;this._reply(e,t,i).then(function(){o.didExecuteAction(e,t),t.type&&t.target&&("re.notifica.action.Browser"==t.type||"re.notifica.action.App"==t.type||"re.notifica.action.Telephone"==t.type?window.location.href=t.target:"re.notifica.action.Mail"==t.type?window.location.href="mailto:"+t.target:"re.notifica.action.SMS"==t.type?window.location.href="tel:"+t.target:"re.notifica.action.Custom"==t.type&&o.shouldPerformActionWithURL(t.target))}).catch(function(){o.didFailToExecuteAction(e,t)})}},{key:"_reply",value:function(e,t,i){return this.network.fetch("POST","/reply",!0,{userID:this.device.userID,deviceID:this.device.deviceID,notification:e._id,data:i,label:t.label})}},{key:"_dataURItoBlob",value:function(e){var t,i;t=(-1!==e.split(",")[0].indexOf("base64")?atob:decodeURI)(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0];for(var o=new Array,n=0;n<t.length;n++)o[n]=t.charCodeAt(n);return new Blob([new Uint8Array(o)],{type:i})}},{key:"_uploadFile",value:function(e,t){var i=new FormData;return i.append("file",e),this.network.fetch("POST","/upload/"+t,!0,i,!0).then(function(e){return"https://s3-eu-west-1.amazonaws.com/notificare-storage"+e.filename})}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareScannables=function(){function t(e){_classCallCheck(this,t),this.options=e,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options)}return _createClass(t,[{key:"fetchScannable",value:function(e){var t=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null,i={};return t.userID&&(i.userID=t.userID),t.deviceID&&(i.deviceID=t.deviceID),this.network.fetch("GET","/scannable/tag/"+encodeURIComponent(e),!0,i)}}]),t}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var o=i.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var NotificareStorage=function(){function t(e){_classCallCheck(this,t),this.options=e,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options)}return _createClass(t,[{key:"fetchAssets",value:function(e){var i=this,t=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null,o={};return t.userID&&(o.userID=t.userID),t.deviceID&&(o.deviceID=t.deviceID),this.network.fetch("GET","/asset/forgroup/"+encodeURIComponent(e),!0,o).then(function(e){var t=[];return e&&e.assets&&0<e.assets.length&&e.assets.forEach(function(e){t.push({title:e.title,description:e.description,url:e.key?i.options.assetsUrl+e.key:null,metaData:e.metaData,extra:e.extra,button:e.button})}),t})}}]),t}();