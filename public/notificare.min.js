/*!
 * Notificare -  v2.0.9 (https://notificare.com)
 * Copyright 2012 - 2019 Notificare
 */
"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),Notificare=function(){function e(i){_classCallCheck(this,e),this.options={sdkVersion:"2.0.9",fullHost:window.location.protocol+"//"+window.location.host,apiUrl:"https://cloud.notifica.re/api",awsStorage:"https://push.notifica.re/upload",websitePushUrl:"https://push.notifica.re/website-push/safari",assetsUrl:"https://push.notifica.re/asset/file/"},this.deviceManager=null,this.network=null,this.eventLogger=null,this.geo=null,this.push=null,this.storage=null,this.core=new NotificareCore,this.ua=new UAParser;var t=null;localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(t=localStorage.getItem("notificarePreferredLanguage")+"-"+localStorage.getItem("notificarePreferredRegion")),this.preferredLanguage=t,i&&(this.options=this.core.mergeOptions(i,this.options)),this.didActivateWorker=null,this.onReady=null,this.didRegisterDevice=null,this.didFailToRegisterDevice=null,this.didFailToRegisterForNotifications=null,this.didReceiveNotification=null,this.didReceiveSystemNotification=null,this.didReceiveUnknownNotification=null,this.didReceiveWorkerPush=null,this.didOpenNotification=null,this.willExecuteAction=null,this.didExecuteAction=null,this.didNotExecuteAction=null,this.didFailToExecuteAction=null,this.shouldPerformActionWithURL=null,this.didUpdateBadge=null,this.didUpdateLocation=null,this.didFailToUpdateLocation=null,this.sessionTimeout=null,this.sessionCloseListener=null,this.exponentialFallback=3e3,this.maxFallback=6e4}return _createClass(e,[{key:"launch",value:function(){var e=this;if("undefined"!=typeof NOTIFICARE_PLUGIN_OPTIONS){if(this.options=this.core.mergeOptions(NOTIFICARE_PLUGIN_OPTIONS,this.options),this.options.useTestEnv&&(this.options=this.core.mergeOptions({apiUrl:"https://cloud-test.notifica.re/api",awsStorage:"https://push-test.notifica.re/upload",websitePushUrl:"https://push-test.notifica.re/website-push/safari",assetsUrl:"https://push-test.notifica.re/asset/file/"},this.options)),!this.options)return void console.warn("Notificare: Failed to load /config.json options, please check your config file.");this._initialSetup()}else fetch("/config.json").then(function(e){return e.json()}).then(function(i){e.options=e.core.mergeOptions(i,e.options),e.options.useTestEnv&&(e.options=e.core.mergeOptions({apiUrl:"https://cloud-test.notifica.re/api",awsStorage:"https://push-test.notifica.re/upload",websitePushUrl:"https://push-test.notifica.re/website-push/safari",assetsUrl:"https://push-test.notifica.re/asset/file/"},e.options)),e.options?e._initialSetup():console.warn("Notificare: Failed to load /config.json options, please check your config file.")}).catch(function(){console.warn("Notificare: Failed to load /config.json, please check your config file.")})}},{key:"_initialSetup",value:function(){var e=this;this.network=new NotificareNetwork(this.options),this.appConfig=new NotificareAppConfig(this.options),this.eventLogger=new NotificareEventLogger(this.options),this.deviceManager=new NotificareDeviceManager(this.options),this.geo=new NotificareGeo(this.options),this.push=new NotificarePush(this.options),this.storage=new NotificareStorage(this.options),this.scannables=new NotificareScannables(this.options),this.loyalty=new NotificareLoyalty(this.options),this.inboxManager=new NotificareInboxManager(this.options),this._migrateOldVersions(),this.appConfig.fetchApplicationInfo().then(function(i){e.deviceManager.didRegisterDevice=function(t){e.isWebPushEnabled()||e._start(i),"function"==typeof e.didRegisterDevice&&e.didRegisterDevice(t),parseInt(localStorage.getItem("notificareRegistration"))||(e.eventLogger.event("re.notifica.event.application.Install",null),e.eventLogger.event("re.notifica.event.application.Registration",null),localStorage.setItem("notificareRegistration",1))},e.deviceManager.didFailToRegisterDevice=function(i){"function"==typeof e.didFailToRegisterDevice&&e.didFailToRegisterDevice(i)},e.deviceManager.device.deviceID?e.options.appVersion!==e.deviceManager.device.appVersion&&e.eventLogger.event("re.notifica.event.application.Upgrade",null):(localStorage.getItem("notificareRegistration")||localStorage.setItem("notificareRegistration",0),e.deviceManager.registerTemporaryDevice()),e.push.didUnsubscribePushRegistration=function(){e.deviceManager.registerTemporaryDevice()},e.push.didReceiveNotification=function(i){"function"==typeof e.didReceiveNotification&&e.didReceiveNotification(i),e.inboxManager.refreshBadge(),e.eventLogger.event("re.notifica.event.notification.Receive",{notification:i})},e.push.didClickNotification=function(i){var t=e.appConfig.application.websitePushConfig.urlFormatString.replace("%@",i);window.location.replace(t),e._handleURLChange()},e.push.didClickReplyInNotification=function(i,t,n){e.network.fetch("GET","/notification/"+i).then(function(i){i&&i.notification&&(e.push.handleAction(i.notification,t),e.inboxManager.refreshBadge())}),n||e.eventLogger.event("re.notifica.event.notification.Open",{notification:i})},e.push.didReceiveSystemNotification=function(i){i.systemType&&i.systemType.match(/^re\.notifica\./)?"re.notifica.notification.system.Application"===i.systemType&&e.appConfig.fetchApplicationInfo():"function"==typeof e.didReceiveSystemNotification&&e.didReceiveSystemNotification(i)},e.push.didReceiveWorkerPush=function(i){"function"==typeof e.didReceiveWorkerPush&&e.didReceiveWorkerPush(i)},e.push.didReceiveWorkerUnknownPush=function(i){"function"==typeof e.didReceiveUnknownNotification&&e.didReceiveUnknownNotification(i)},e.push.willExecuteAction=function(i,t){"function"==typeof e.willExecuteAction&&e.willExecuteAction(i,t)},e.push.didExecuteAction=function(i,t){"function"==typeof e.didExecuteAction&&e.didExecuteAction(i,t)},e.push.didNotExecuteAction=function(i,t){"function"==typeof e.didNotExecuteAction&&e.didNotExecuteAction(i,t)},e.push.didFailToExecuteAction=function(i,t){"function"==typeof e.didFailToExecuteAction&&e.didFailToExecuteAction(i,t)},e.push.shouldPerformActionWithURL=function(i){"function"==typeof e.shouldPerformActionWithURL&&e.shouldPerformActionWithURL(i)},e.inboxManager.didUpdateBadge=function(i){"function"==typeof e.didUpdateBadge&&e.didUpdateBadge(i)},e.geo.didUpdateLocation=function(i){"function"==typeof e.didUpdateLocation&&e.didUpdateLocation(i)},e.geo.didFailToUpdateLocation=function(i){"function"==typeof e.didFailToUpdateLocation&&e.didFailToUpdateLocation(i)},e.deviceManager.device.deviceID&&e._start(i),e.inboxManager.refreshBadge()}).catch(function(i){i instanceof Response?i&&i.status&&(0===i.status||502===i.status||503===i.status||400===i.status)&&(console.warn("Notificare: Failed to load application, retrying exponentially..."),setTimeout(e._initialSetup.bind(e),e.exponentialFallback),e.exponentialFallback<e.maxFallback?e.exponentialFallback*=2:e.exponentialFallback=e.maxFallback):console.log(i)})}},{key:"_start",value:function(e){var i=this;"function"==typeof this.onReady&&this.onReady(e),this._handleURLChange(),localStorage.getItem("notificareSession")||(localStorage.setItem("notificareSession",JSON.stringify({id:this.core.uuidv4(),start:new Date})),this.eventLogger.event("re.notifica.event.application.Open",null)),window.addEventListener("focus",function(){localStorage.getItem("notificareSession")||(localStorage.setItem("notificareSession",JSON.stringify({id:i.core.uuidv4(),start:new Date})),i.eventLogger.event("re.notifica.event.application.Open",null))}),this.sessionCloseListener||(this.sessionCloseListener=window.addEventListener("blur",function(){if(localStorage.getItem("notificareSession")){var e=JSON.parse(localStorage.getItem("notificareSession"));i.eventLogger.event("re.notifica.event.application.Close",{data:{length:i.core.secondsBetweenDates(new Date,new Date(e.start))}}),setTimeout(function(){localStorage.removeItem("notificareSession")},1e3)}}))}},{key:"_handleURLChange",value:function(){var e=this;if(this.appConfig.application&&this.appConfig.application.websitePushConfig&&this.appConfig.application.websitePushConfig.urlFormatString){var i=new RegExp(this.appConfig.application.websitePushConfig.urlFormatString.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1").replace("%@","(\\w+)")).exec(window.location);i&&i.length>1&&this.push.openNotification(i[1]).then(function(i){e.inboxManager.refreshBadge(),"function"==typeof e.didOpenNotification&&e.didOpenNotification(i)})}}},{key:"_migrateOldVersions",value:function(){if(localStorage.getItem("deviceToken")){var e=new Date,i=new RegExp("http");localStorage.setItem("notificareDevice",JSON.stringify({deviceID:localStorage.getItem("deviceToken"),platform:this.ua.getBrowser().name,osString:this.ua.getBrowser().name+" "+this.ua.getBrowser().major,osVersion:this.ua.getBrowser().major,transport:i.test(localStorage.getItem("deviceToken"))?"WebPush":"WebsitePush",sdkVersion:this.options.sdkVersion,appVersion:this.options.appVersion,deviceString:this.ua.getBrowser().name+" "+this.ua.getBrowser().major+" | "+this.ua.getOS().name+" "+this.ua.getOS().version,timeZoneOffset:e.getTimezoneOffset()/60*-1,allowedUI:!0})),localStorage.setItem("notificareRegistration",1),this.deviceManager.device=JSON.parse(localStorage.getItem("notificareDevice")),localStorage.removeItem("deviceToken")}localStorage.getItem("badge")&&localStorage.removeItem("badge"),localStorage.getItem("position")&&localStorage.removeItem("position"),localStorage.getItem("regions")&&localStorage.removeItem("regions")}},{key:"isWebPushSupported",value:function(){return"safari"in window&&"pushNotification"in window.safari||"serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window}},{key:"isWebPushEnabled",value:function(){var e=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;return e&&"WebsitePush"===e.transport||e&&"WebPush"===e.transport}},{key:"isLocationServicesEnabled",value:function(){return!!localStorage.getItem("notificarePosition")}},{key:"registerForNotifications",value:function(){var e=this;this.push.registerForNotifications().then(function(i){"string"==typeof i?e.deviceManager.registerSafariDevice(i):e.deviceManager.registerWebPushDevice(i)}).catch(function(i){"function"==typeof e.didFailToRegisterForNotifications&&e.didFailToRegisterForNotifications(i)})}},{key:"registerDevice",value:function(e,i){return this.deviceManager.registerDevice(e,i)}},{key:"unregisterForNotifications",value:function(){this.push.unregisterForNotifications()}},{key:"myDevice",value:function(){var e=this.deviceManager.device;return localStorage.getItem("notificarePosition")&&(e.location=JSON.parse(localStorage.getItem("notificarePosition"))),e}},{key:"updatePreferredLanguage",value:function(e){if(e){var i=e.split("-");if(i&&2===i.length){return i[0]+"-"+i[0]!=localStorage.getItem("notificarePreferredLanguage")+"-"+localStorage.getItem("notificarePreferredRegion")?(localStorage.setItem("notificarePreferredLanguage",i[0]),localStorage.setItem("notificarePreferredRegion",i[1]),this.preferredLanguage=localStorage.getItem("notificarePreferredLanguage")+"-"+localStorage.getItem("notificarePreferredRegion"),this.deviceManager.updateLanguage(i[0],i[1])):Promise.resolve({message:"Skipping preferred language update, nothing changed."})}return Promise.reject(new Error("Not a valid preferred language. Use a ISO 639-1 language code and a ISO 3166-2 region code (e.g. en-US)."))}return localStorage.removeItem("notificarePreferredLanguage"),localStorage.removeItem("notificarePreferredRegion"),this.preferredLanguage=null,this.deviceManager.updateLanguage(this.core.deviceLanguage(),this.core.deviceRegion())}},{key:"fetchTags",value:function(){return this.deviceManager.fetchTags()}},{key:"addTag",value:function(e){return this.deviceManager.addTag(e)}},{key:"addTags",value:function(e){return this.deviceManager.addTags(e)}},{key:"removeTag",value:function(e){return this.deviceManager.removeTag(e)}},{key:"removeTags",value:function(e){return this.deviceManager.removeTags(e)}},{key:"clearTags",value:function(){return this.deviceManager.clearTags()}},{key:"fetchUserData",value:function(){var e=this;return this.deviceManager.fetchUserData().then(function(i){var t=[];return e.appConfig.application.userDataFields&&e.appConfig.application.userDataFields.length>0&&e.appConfig.application.userDataFields.forEach(function(e){var n=e;i.userData&&i.userData[e.key]?n.value=i.userData[e.key]:n.value="",t.push(n)}),t})}},{key:"updateUserData",value:function(e){var i={};return e.forEach(function(e){i[e.key]=e.value}),this.deviceManager.updateUserData(i)}},{key:"fetchDoNotDisturb",value:function(){return this.deviceManager.fetchDoNotDisturb()}},{key:"updateDoNotDisturb",value:function(e,i){return this.deviceManager.updateDoNotDisturb({start:e,end:i})}},{key:"clearDoNotDisturb",value:function(){return this.deviceManager.clearDoNotDisturb()}},{key:"startLocationUpdates",value:function(){this.appConfig.application.services&&this.appConfig.application.services.locationServices?this.geo.startLocationUpdates():"function"==typeof this.didFailToUpdateLocation&&this.didFailToUpdateLocation(new Error("Location Services is not available for your account"))}},{key:"stopLocationUpdates",value:function(){if(this.appConfig.application.services&&this.appConfig.application.services.locationServices)return this.geo.stopLocationUpdates()}},{key:"fetchAssets",value:function(e){return this.appConfig.application.services&&this.appConfig.application.services.storage?this.storage.fetchAssets(e):Promise.reject(new Error("Storage is not available for your account"))}},{key:"fetchScannables",value:function(e){return this.scannables.fetchScannable(e)}},{key:"fetchPassWithSerial",value:function(e){return this.appConfig.application.services&&this.appConfig.application.services.loyalty?this.loyalty.fetchPassWithSerial(e):Promise.reject(new Error("Loyalty is not available for your account"))}},{key:"fetchPassWithBarcode",value:function(e){return this.appConfig.application.services&&this.appConfig.application.services.loyalty?this.loyalty.fetchPassWithBarcode(e):Promise.reject(new Error("Loyalty is not available for your account"))}},{key:"logCustomEvent",value:function(e,i){if(e){var t="re.notifica.event.custom."+e;return this.eventLogger.event(t,i?{data:i}:null)}return Promise.reject(new Error("No event name provided"))}},{key:"handleAction",value:function(e,i){this.push.handleAction(e,i)}},{key:"performCloudAPIRequest",value:function(e,i,t){return this.network.fetch(e,i,!0,t)}}]),e}(),NotificareAppConfig=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options),this.application=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null}return _createClass(e,[{key:"fetchApplicationInfo",value:function(){var e=this;return new Promise(function(i,t){e.network.fetch("GET","/application/info").then(function(t){t&&t.application&&(localStorage.setItem("notificareApplication",JSON.stringify(t.application)),e.application=JSON.parse(localStorage.getItem("notificareApplication")),i(e.application))}).catch(function(e){t(e)})})}}]),e}()),NotificareCore=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(){_classCallCheck(this,e),this.ua=new UAParser}return _createClass(e,[{key:"mergeOptions",value:function(e,i){return Object.keys(e).forEach(function(t){i[t]=e[t]}),i}},{key:"randomId",value:function(){return Math.floor(1e16*(1+Math.random())).toString(16).substring(1)}},{key:"uuidv4",value:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})}},{key:"getPushToken",value:function(e){return{endpoint:e.endpoint,keys:this.getPushKeys(e)}}},{key:"getPushKeys",value:function(e){if(e&&e.getKey){var i=e.getKey("p256dh"),t=e.getKey("auth");return i&&t?{p256dh:this.arrayBufferToBase64(i),auth:this.arrayBufferToBase64(t)}:null}return null}},{key:"base64UrlToUint8Array",value:function(e){for(var i=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(i),n=new Uint8Array(t.length),o=0;o<t.length;++o)n[o]=t.charCodeAt(o);return n}},{key:"arrayBufferToBase64",value:function(e){return this.uint8ArrayToBase64(new Uint8Array(e))}},{key:"arrayBufferToBase64Url",value:function(e){return this.uint8ArrayToBase64Url(new Uint8Array(e))}},{key:"uint8ArrayToBase64",value:function(e){for(var i="",t=e.byteLength,n=0;n<t;n++)i+=String.fromCharCode(e[n]);return window.btoa(i)}},{key:"uint8ArrayToBase64Url",value:function(e){return this.uint8ArrayToBase64(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/g,"")}},{key:"postMessageToServiceWorker",value:function(e){return new Promise(function(i,t){var n=new MessageChannel;n.port1.onmessage=function(e){e.data.error?t(e.data.error):i(e.data)},navigator.serviceWorker.controller.postMessage(JSON.stringify(e),[n.port2])})}},{key:"distanceBetweenPoints",value:function(e,i){var t=e.latitude,n=i.latitude,o=e.longitude,a=i.longitude,r=t*Math.PI/180,s=n*Math.PI/180,c=(n-t)*Math.PI/180,l=(a-o)*Math.PI/180,u=Math.sin(c/2)*Math.sin(c/2)+Math.cos(r)*Math.cos(s)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}},{key:"secondsBetweenDates",value:function(e,i){var t=(e.getTime()-i.getTime())/1e3;return Math.abs(t)}},{key:"deviceLanguage",value:function(){var e="en",i=(window.navigator.userLanguage||window.navigator.language).split("-");return i&&i.length>0&&(e=i[0]),e}},{key:"deviceRegion",value:function(){var e="US",i=(window.navigator.userLanguage||window.navigator.language).split("-");return i&&i.length>1&&(e=i[1]),e}},{key:"fetchLocallyStoredProperty",value:function(e){return e&&localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):null}}]),e}()),NotificareDeviceManager=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.network=new NotificareNetwork(this.options),this.ua=new UAParser,this.core=new NotificareCore,this.device=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):{deviceID:null,oldDeviceID:null,keys:null,userID:null,userName:null,platform:null,osString:null,osVersion:null,sdkVersion:null,appVersion:null,language:null,region:null,deviceString:null,transport:null,timeZoneOffset:null,allowedUI:!1},this.didRegisterDevice=null,this.didFailToRegisterDevice=null}return _createClass(e,[{key:"registerTemporaryDevice",value:function(){var e=this,i=this.core.deviceLanguage(),t=this.core.deviceRegion();localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(i=localStorage.getItem("notificarePreferredLanguage"),t=localStorage.getItem("notificarePreferredRegion"));var n=new Date,o=this.ua.getBrowser().name,a=this.core.uuidv4(),r={deviceID:a,oldDeviceID:this.device.deviceID&&this.device.deviceID!=a?this.device.deviceID:null,keys:null,userID:this.device.userID,userName:this.device.userID?this.device.userName:null,platform:o,osString:this.ua.getBrowser().name+" "+this.ua.getBrowser().major,osVersion:this.ua.getBrowser().major,sdkVersion:this.options.sdkVersion,appVersion:this.options.appVersion,language:i,region:t,deviceString:this.ua.getBrowser().name+" "+this.ua.getBrowser().major+" | "+this.ua.getOS().name+" "+this.ua.getOS().version,transport:"Notificare",timeZoneOffset:n.getTimezoneOffset()/60*-1,allowedUI:!1};this._registerDevice(r).then(function(){r.language=e.core.deviceLanguage(),r.region=e.core.deviceRegion(),localStorage.setItem("notificareDevice",JSON.stringify(r)),e.device=JSON.parse(localStorage.getItem("notificareDevice")),e.didRegisterDevice(e.device)}).catch(function(i){e.didFailToRegisterDevice(i)})}},{key:"registerWebPushDevice",value:function(e){var i=this,t=this.core.deviceLanguage(),n=this.core.deviceRegion();localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(t=localStorage.getItem("notificarePreferredLanguage"),n=localStorage.getItem("notificarePreferredRegion"));var o=new Date,a=this.ua.getBrowser().name,r=e.endpoint,s=e.keys,c={deviceID:r,oldDeviceID:this.device.deviceID&&this.device.deviceID!=r?this.device.deviceID:null,keys:s,userID:this.device.userID,userName:this.device.userID?this.device.userName:null,platform:a,osString:this.ua.getBrowser().name+" "+this.ua.getBrowser().major,osVersion:this.ua.getBrowser().major,sdkVersion:this.options.sdkVersion,appVersion:this.options.appVersion,language:t,region:n,deviceString:this.ua.getBrowser().name+" "+this.ua.getBrowser().major+" | "+this.ua.getOS().name+" "+this.ua.getOS().version,transport:"WebPush",timeZoneOffset:o.getTimezoneOffset()/60*-1,allowedUI:!0};this._registerDevice(c).then(function(){c.language=i.core.deviceLanguage(),c.region=i.core.deviceRegion(),localStorage.setItem("notificareDevice",JSON.stringify(c)),i.device=JSON.parse(localStorage.getItem("notificareDevice")),i.didRegisterDevice(i.device)}).catch(function(e){i.didFailToRegisterDevice(e)})}},{key:"registerSafariDevice",value:function(e){var i=this,t=this.core.deviceLanguage(),n=this.core.deviceRegion();localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(t=localStorage.getItem("notificarePreferredLanguage"),n=localStorage.getItem("notificarePreferredRegion"));var o=new Date,a={deviceID:e,oldDeviceID:this.device.deviceID&&this.device.deviceID!=e?this.device.deviceID:null,keys:null,userID:this.device.userID,userName:this.device.userID?this.device.userName:null,platform:"Safari",osString:this.ua.getBrowser().name+" "+this.ua.getBrowser().major,osVersion:this.ua.getBrowser().major,sdkVersion:this.options.sdkVersion,appVersion:this.options.appVersion,language:t,region:n,deviceString:this.ua.getBrowser().name+" "+this.ua.getBrowser().major+" | "+this.ua.getOS().name+" "+this.ua.getOS().version,transport:"WebsitePush",timeZoneOffset:o.getTimezoneOffset()/60*-1,allowedUI:!0};this._registerDevice(a).then(function(){a.language=i.core.deviceLanguage(),a.region=i.core.deviceRegion(),localStorage.setItem("notificareDevice",JSON.stringify(a)),i.device=JSON.parse(localStorage.getItem("notificareDevice")),i.didRegisterDevice(i.device)}).catch(function(e){i.didFailToRegisterDevice(e)})}},{key:"registerDevice",value:function(e,i){var t=this;return this.device.userID=e,this.device.userName=e?i:null,this._registerDevice(this.device).then(function(){return localStorage.setItem("notificareDevice",JSON.stringify(t.device)),t.device=JSON.parse(localStorage.getItem("notificareDevice")),t.device})}},{key:"_registerDevice",value:function(e){return this.network.fetch("POST","/device",!0,e)}},{key:"updateLanguage",value:function(e,i){var t=this;return this.device.language=e,this.device.region=i,this._registerDevice(this.device).then(function(){return t.device.language=t.core.deviceLanguage(),t.device.region=t.core.deviceRegion(),localStorage.setItem("notificareDevice",JSON.stringify(t.device)),t.device=JSON.parse(localStorage.getItem("notificareDevice")),t.device})}},{key:"fetchTags",value:function(){return this.network.fetch("GET","/device/"+encodeURIComponent(this.device.deviceID)+"/tags").then(function(e){var i=[];return e&&e.tags&&e.tags.length>0&&e.tags.forEach(function(e){i.push(e)}),i})}},{key:"addTag",value:function(e){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/addtag",!0,{tag:e})}},{key:"addTags",value:function(e){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/addtags",!0,{tags:e})}},{key:"removeTag",value:function(e){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/removetag",!0,{tag:e})}},{key:"removeTags",value:function(e){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/removetags",!0,{tags:e})}},{key:"clearTags",value:function(){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/cleartags")}},{key:"fetchUserData",value:function(){return this.network.fetch("GET","/device/"+encodeURIComponent(this.device.deviceID)+"/userdata")}},{key:"updateUserData",value:function(e){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/userdata",!0,e)}},{key:"fetchDoNotDisturb",value:function(){return this.network.fetch("GET","/device/"+encodeURIComponent(this.device.deviceID)+"/dnd").then(function(e){return e.dnd})}},{key:"updateDoNotDisturb",value:function(e){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/dnd",!0,e)}},{key:"clearDoNotDisturb",value:function(){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.device.deviceID)+"/cleardnd")}}]),e}()),NotificareEventLogger=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.network=new NotificareNetwork(this.options)}return _createClass(e,[{key:"event",value:function(e,i){var t={},n=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;if(n&&n.userID&&(t.userID=n.userID),e&&(t.type=e),localStorage.getItem("notificareSession")){var o=JSON.parse(localStorage.getItem("notificareSession"));t.sessionID=o.id}return i&&i.notification&&(t.notification=i.notification),i&&i.data&&(t.data=i.data),n&&n.deviceID?(t.deviceID=n.deviceID,this.network.fetch("POST","/event",!0,t)):Promise.reject(new Error("No device token found when registering "+t.type))}}]),e}()),NotificareGeo=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options),this.deviceManager=new NotificareDeviceManager(this.options),this.navigatorWatchPosition=null,this.didUpdateLocation=null,this.didFailToUpdateLocation=null}return _createClass(e,[{key:"startLocationUpdates",value:function(){var e=this;navigator.geolocation&&(this.navigatorWatchPosition=navigator.geolocation.watchPosition(function(i){e._handleLocationUpdate(i).then(function(i){e.didUpdateLocation(i)}).catch(function(i){e.didFailToUpdateLocation(i)})},function(i){e.didFailToUpdateLocation(i)},this.options.geolocationOptions))}},{key:"stopLocationUpdates",value:function(){navigator.geolocation&&(navigator.geolocation.clearWatch(this.navigatorWatchPosition),this._updateLocation({coords:{latitude:null,longitude:null}},null).then(function(){localStorage.removeItem("notificarePosition")}))}},{key:"_handleLocationUpdate",value:function(e){var i=this;return new Promise(function(t,n){var o=localStorage.getItem("notificarePosition")?JSON.parse(localStorage.getItem("notificarePosition")):null;o&&o.latitude==e.coords.latitude&&o.longitude==e.coords.longitude?i._fetchNearestRegions(e).then(function(n){i._handleRegions(e,n.regions),t(e)}).catch(function(e){n(new Error(e))}):i._fetchDeviceCountry(e).then(function(o){i._updateLocation(e,o.country).then(function(){localStorage.setItem("notificarePosition",JSON.stringify({accuracy:isNaN(e.coords.accuracy)?null:e.coords.accuracy,altitude:isNaN(e.coords.altitude)?null:e.coords.altitude,altitudeAccuracy:isNaN(e.coords.altitudeAccuracy)?null:e.coords.altitudeAccuracy,heading:isNaN(e.coords.heading)?null:e.coords.heading,speed:isNaN(e.coords.speed)?null:e.coords.speed,latitude:e.coords.latitude,longitude:e.coords.longitude,country:o.country,timestamp:e.timestamp})),i._fetchNearestRegions(e).then(function(n){i._handleRegions(e,n.regions),t(e)}).catch(function(e){n(new Error(e))})}).catch(function(e){n(e)})}).catch(function(e){n(e)})})}},{key:"_updateLocation",value:function(e,i){return this.network.fetch("PUT","/device/"+encodeURIComponent(this.deviceManager.device.deviceID),!0,{latitude:e.coords.latitude,longitude:e.coords.longitude,altitude:isNaN(e.coords.altitude)?null:e.coords.altitude,bearing:isNaN(e.coords.heading)?null:e.coords.heading,speed:isNaN(e.coords.speed)?null:e.coords.speed,country:i,locationServicesAuthStatus:"use",language:this.deviceManager.device.language,region:this.deviceManager.device.region})}},{key:"_fetchDeviceCountry",value:function(e){return fetch("https://maps.googleapis.com/maps/api/geocode/json?latlng="+e.coords.latitude+","+e.coords.longitude+"&sensor=false&key="+this.options.googleMapsAPIKey).then(function(e){return e.json()}).then(function(e){var i=null;if(e&&e.results&&e.results.length>0)for(var t=0;t<e.results[0].address_components.length;t++)for(var n=0;n<e.results[0].address_components[t].types.length;n++)"country"==e.results[0].address_components[t].types[n]&&(i=e.results[0].address_components[t].short_name);return{country:i}}).catch(function(){return{country:null}})}},{key:"_fetchNearestRegions",value:function(e){return this.network.fetch("GET","/region/bylocation/"+e.coords.latitude+"/"+e.coords.longitude)}},{key:"_handleRegions",value:function(e,t){var n=this;t&&t.length>0&&t.forEach(function(t){var o=localStorage.getItem("notificareRegions")?JSON.parse(localStorage.getItem("notificareRegions")):[],a={latitude:e.latitude,longitude:e.longitude},r={latitude:t.geometry.coordinates[1],longitude:t.geometry.coordinates[0]};n.core.distanceBetweenPoints(a,r)<=t.distance?o.indexOf(t._id)<0&&n._executeTrigger("re.notifica.trigger.region.Enter",t).then(function(e){o.push(e._id),localStorage.setItem("notificareRegions",JSON.stringify(o))}):o.indexOf(t._id)>-1&&n._executeTrigger("re.notifica.trigger.region.Exit",t).then(function(e){o.splice(i,1),localStorage.setItem("notificareRegions",JSON.stringify(o))})})}},{key:"_executeTrigger",value:function(e,i){return this.network.fetch("POST","/trigger/"+e,!0,{region:i._id,deviceID:this.deviceManager.device.deviceID})}}]),e}()),NotificareInboxManager=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.network=new NotificareNetwork(this.options),this.eventLogger=new NotificareEventLogger(this.options),this.badge=localStorage.getItem("notificareBadge")?localStorage.getItem("notificareBadge"):0,this.didUpdateBadge=null}return _createClass(e,[{key:"myBadge",value:function(){return this.badge}},{key:"fetchInbox",value:function(e,i,t){var n=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;return this.network.fetch("GET","/notification/inbox/fordevice/"+encodeURIComponent(n.deviceID),!0,{since:e,skip:i,limit:t})}},{key:"openInboxItem",value:function(e){var i=this;return Promise.all([this.network.fetch("GET","/notification/"+e.notification),this.eventLogger.event("re.notifica.event.notification.Open",{notification:e.notification})]).then(function(e){return i.refreshBadge(),e[0].notification})}},{key:"markAsRead",value:function(e){var i=this;return Promise.all([this.eventLogger.event("re.notifica.event.notification.Open",{notification:e.notification})]).then(function(){return i.refreshBadge(),e})}},{key:"removeFromInbox",value:function(e){var i=this;return Promise.all([this.network.fetch("DELETE","/notification/inbox/"+e._id)]).then(function(){return i.refreshBadge(),e})}},{key:"clearInbox",value:function(){var e=this,i=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;return Promise.all([this.network.fetch("DELETE","/notification/inbox/fordevice/"+encodeURIComponent(i.deviceID))]).then(function(){return e.refreshBadge(),[]})}},{key:"refreshBadge",value:function(){var e=this,i=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null;i&&i.deviceID&&this.network.fetch("GET","/notification/inbox/fordevice/"+encodeURIComponent(i.deviceID),!0,{since:null,skip:0,limit:1}).then(function(i){localStorage.setItem("notificareBadge",i.unread),e.badge=localStorage.getItem("notificareBadge")?localStorage.getItem("notificareBadge"):0,"function"==typeof e.didUpdateBadge&&e.didUpdateBadge(e.badge)})}}]),e}()),NotificareLoyalty=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options)}return _createClass(e,[{key:"fetchPassWithSerial",value:function(e){return this.network.fetch("GET","/pass/forserial/"+e)}},{key:"fetchPassWithBarcode",value:function(e){return this.network.fetch("GET","/pass/forbarcode/"+e)}}]),e}()),NotificareNetwork=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.core=new NotificareCore,this.headers={accept:"application/json",contentType:"application/json; charset=utf-8"}}return _createClass(e,[{key:"fetch",value:function(e){function i(i,t,n,o,a){return e.apply(this,arguments)}return i.toString=function(){return e.toString()},i}(function(e,i,t,n,o){var a=new window.Headers,r=this.options.apiUrl+i,s={credentials:"include",method:e,mode:"cors"},c=this.core.deviceLanguage(),l=this.core.deviceRegion();if(localStorage.getItem("notificarePreferredLanguage")&&localStorage.getItem("notificarePreferredRegion")&&(c=localStorage.getItem("notificarePreferredLanguage"),l=localStorage.getItem("notificarePreferredRegion")),a.append("Accept-Language",c+"-"+l),o||(a.append("Accept",this.headers.accept),a.append("Content-Type",this.headers.contentType)),(t||void 0===t)&&a.append("Authorization","Basic "+btoa(this.options.appKey+":"+this.options.appSecret)),s.headers=a,n)if("GET"===e||"DELETE"===e){r=r+"?"+Object.keys(n).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&")}else"POST"!==e&&"PUT"!==e||(s.body=o?n:JSON.stringify(n));return fetch(r,s).then(function(e){return e.ok?e:Promise.reject(e)}).then(function(e){return e.text()}).then(function(e){return e?JSON.parse(e):null})})}]),e}()),NotificarePush=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.core=new NotificareCore,this.eventLogger=new NotificareEventLogger(this.options),this.network=new NotificareNetwork(this.options),this.application=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null,this.device=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null,this.serviceWorkerRegistration=null,"serviceWorker"in navigator&&(navigator.serviceWorker.onmessage=this._handlePushWorkerMessages.bind(this)),this.didActivateWorker=null,this.didUnsubscribePushRegistration=null,this.didReceiveNotification=null,this.didClickNotification=null,this.didClickReplyInNotification=null,this.didReceiveSystemNotification=null,this.didReceiveWorkerPush=null,this.didReceiveWorkerUnknownPush=null,this.willExecuteAction=null,this.didExecuteAction=null,this.didNotExecuteAction=null,this.didFailToExecuteAction=null,this.shouldPerformActionWithURL=null,this.UI_CONSTANTS={body:document.getElementsByTagName("BODY")[0],canvas:document.createElement("canvas"),textarea:document.createElement("textarea"),video:document.createElement("video"),next:document.createElement("a"),send:document.createElement("a"),cancel:document.createElement("a"),close:document.createElement("a"),button:document.createElement("a"),modal:document.createElement("div"),bg:document.createElement("div")},this.UI_CONSTANTS.context=this.UI_CONSTANTS.canvas.getContext("2d"),this.UI_CONSTANTS.textarea.setAttribute("class","notificare-text-area"),this.UI_CONSTANTS.textarea.setAttribute("placeholder",this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.keyboard?this.options.UI.text.keyboard:"Type a reply"),this.UI_CONSTANTS.canvas.setAttribute("class","notificare-image"),this.UI_CONSTANTS.video.setAttribute("class","notificare-camera"),this.UI_CONSTANTS.next.setAttribute("class","notificare-send"),this.UI_CONSTANTS.next.appendChild(document.createTextNode(this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.next?this.options.UI.text.next:"Next")),this.UI_CONSTANTS.send.setAttribute("class","notificare-send"),this.UI_CONSTANTS.send.appendChild(document.createTextNode(this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.send?this.options.UI.text.send:"Send")),this.UI_CONSTANTS.cancel.setAttribute("class","notificare-cancel"),this.UI_CONSTANTS.cancel.appendChild(document.createTextNode(this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.cancel?this.options.UI.text.cancel:"Cancel")),this.UI_CONSTANTS.close.setAttribute("class","notificare-close-modal"),this.UI_CONSTANTS.close.appendChild(document.createTextNode(this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.close?this.options.UI.text.close:"Close")),this.UI_CONSTANTS.button.setAttribute("class","notificare-capture-image"),this.UI_CONSTANTS.button.appendChild(document.createTextNode(this.options&&this.options.UI&&this.options.UI.text&&this.options.UI.text.camera?this.options.UI.text.camera:"Take Picture")),this.UI_CONSTANTS.modal.setAttribute("class","notificare-modal"),this.UI_CONSTANTS.bg.setAttribute("class","notificare-modal-bg")}return _createClass(e,[{key:"registerForNotifications",value:function(){var e=this;return new Promise(function(i,t){var n=localStorage.getItem("notificareApplication")?JSON.parse(localStorage.getItem("notificareApplication")):null,o=!1;if(e.options.appHost.indexOf("localhost")>-1?o=!0:e.options.appHost.indexOf("https")>-1&&(o=!0),n.websitePushConfig&&n.websitePushConfig.icon&&n.websitePushConfig.allowedDomains.length>0&&n.websitePushConfig.allowedDomains.indexOf(e.options.fullHost)>-1)if("safari"in window&&"pushNotification"in window.safari&&n.websitePushConfig&&n.websitePushConfig.info&&n.websitePushConfig.info.subject&&n.websitePushConfig.info.subject.UID){var a=window.safari.pushNotification.permission(n.websitePushConfig.info.subject.UID);if("default"==a.permission)try{window.safari.pushNotification.requestPermission(e.options.websitePushUrl,n.websitePushConfig.info.subject.UID,{applicationKey:e.options.appKey},function(e){e.deviceToken?i(e.deviceToken):t(new Error("Not a valid Safari Push Token. Can not proceed."))})}catch(e){t(e)}else"denied"==a.permission?t(a):"granted"==a.permission&&i(a.deviceToken)}else if("serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window)if(n.websitePushConfig&&n.websitePushConfig.gcmApiKey&&n.websitePushConfig.vapid&&n.websitePushConfig.vapid.publicKey&&e.options.serviceWorker)if(o){var r=null;e.options.serviceWorkerScope&&(r={scope:e.options.serviceWorkerScope}),navigator.serviceWorker.register(e.options.serviceWorker,r).then(function(){navigator.serviceWorker.ready.then(function(o){e.serviceWorkerRegistration=o,o.pushManager.getSubscription().then(function(a){if(a&&a.options&&a.options.applicationServerKey&&e.core.arrayBufferToBase64Url(a.options.applicationServerKey)===n.websitePushConfig.vapid.publicKey)a.expirationTime&&Date.now()>a.expirationTime-432e6?a.unsubscribe().then(function(){o.pushManager.subscribe(subscriptionOptions).then(function(t){i(e.core.getPushToken(t))}).catch(function(e){t(e)})}).catch(function(e){t(e)}):i(e.core.getPushToken(a));else{var r={name:"push",userVisibleOnly:!0};n.websitePushConfig.vapid.publicKey&&(r.applicationServerKey=e.core.base64UrlToUint8Array(n.websitePushConfig.vapid.publicKey)),o.pushManager.subscribe(r).then(function(t){i(e.core.getPushToken(t))}).catch(function(i){a&&a.options&&a.options.applicationServerKey&&e.core.arrayBufferToBase64Url(a.options.applicationServerKey)!=n.websitePushConfig.vapid.publicKey?e.serviceWorkerRegistration.pushManager.getSubscription().then(function(e){if(e)return e.unsubscribe()}).then(function(){t(new Error("Subscription for service worker is no longer valid and has been unsubscribed. Please register again."))}):t(i)})}}).catch(function(e){t(e)})})}).catch(function(e){t(e)})}else t(new Error("Service workers are only available over HTTPS or using localhost."));else t(new Error("Please check your Website Push configurations in our dashboard before proceed. Missing a GCM/FCM Server Key, VAPID or incorrect path and scope to the service worker in config.json."));else t(new Error(" Your browser does not support Service Workers nor Safari Website Push."));else t(new Error("Please check your Website Push configurations in our dashboard before proceed. Missing the App Icon and Allowed Domains."))})}},{key:"unregisterForNotifications",value:function(){var e=this;this.device&&"WebPush"===this.device.transport?this.serviceWorkerRegistration.pushManager.getSubscription().then(function(e){if(e)return e.unsubscribe()}).then(function(){e.didUnsubscribePushRegistration()}):"WebsitePush"===this.device.transport&&this.didUnsubscribePushRegistration()}},{key:"_handlePushWorkerMessages",value:function(e){if(e&&e.data){var i=JSON.parse(e.data);switch(i.cmd){case"notificationclick":this.didClickNotification(i.message);break;case"notificationreceive":this.didReceiveNotification(i.message);break;case"notificationreply":this.didClickReplyInNotification(i.message,i.action,i.bg);break;case"system":this.didReceiveSystemNotification(i.message);break;case"workerpush":this.didReceiveWorkerPush(i.message);break;case"unknownpush":this.didReceiveWorkerUnknownPush(i.message);break;case"activate":"function"==typeof this.didActivateWorker&&this.didActivateWorker()}}}},{key:"openNotification",value:function(e){return Promise.all([this.network.fetch("GET","/notification/"+e),this.eventLogger.event("re.notifica.event.notification.Influenced",{notification:e}),this.eventLogger.event("re.notifica.event.notification.Open",{notification:e})]).then(function(e){return e[0].notification})}},{key:"handleAction",value:function(e,i){var t=this;e&&e.actions&&e.actions.length>0&&e.actions.forEach(function(n){n.label==i&&t._handleActionType(e,n)})}},{key:"_handleActionType",value:function(e,i){if(i){this.willExecuteAction(e,i);var t={};"re.notifica.action.Browser"==i.type&&i.target?(window.location.replace(i.target),this._handleReply(e,i,t)):"re.notifica.action.Callback"==i.type?i.camera&&i.keyboard&&!i.target?this._replyWithCameraAndKeyboard(e,i,t):!i.camera||i.keyboard||i.target?i.camera||!i.keyboard||i.target?i.target?this._replyWithTarget(e,i,t):this._handleReply(e,i,null):this._replyWithKeyboard(e,i,t):this._replyWithCamera(e,i,t):"re.notifica.action.Mail"==i.type?(window.location.href="mailto:"+i.target,this._handleReply(e,i,t)):"re.notifica.action.Custom"==i.type?(this.shouldPerformActionWithURL(i.target),this._handleReply(e,i,t)):this.didFailToExecuteAction(e,i)}}},{key:"_replyWithKeyboard",value:function(e,i,t){var n=this,o=this.UI_CONSTANTS;if(o.bg&&(o.bg.remove(),o.modal)){for(;o.modal.firstChild;)o.modal.removeChild(o.modal.firstChild);o.modal.remove()}o.modal.appendChild(o.textarea),o.modal.appendChild(o.send),o.modal.appendChild(o.close),o.bg.appendChild(o.modal),o.body.appendChild(o.bg),o.textarea.style.display="block",o.textarea.value="",o.send.style.display="block",o.close.style.display="block",o.send.addEventListener("click",function(a){a.preventDefault(),t={message:o.textarea.value},n._handleReply(e,i,t),o.bg.remove()}),o.close.addEventListener("click",function(t){t.preventDefault(),o.bg.remove(),n.didNotExecuteAction(e,i)})}},{key:"_replyWithCamera",value:function(e,i,t){var n=this,o=this.UI_CONSTANTS;if(o.bg&&(o.bg.remove(),o.modal)){for(;o.modal.firstChild;)o.modal.removeChild(o.modal.firstChild);o.modal.remove()}navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(a){o.video.srcObject=a,o.video.play(),o.modal.appendChild(o.video),o.modal.appendChild(o.button),o.modal.appendChild(o.canvas),o.modal.appendChild(o.send),o.modal.appendChild(o.cancel),o.modal.appendChild(o.close),o.bg.appendChild(o.modal),o.body.appendChild(o.bg),o.video.style.display="block",o.canvas.style.display="none",o.send.style.display="none",o.cancel.style.display="none",o.video.style.display="block",o.button.style.display="block",o.close.style.display="block",o.button.addEventListener("click",function(e){e.preventDefault(),o.context.drawImage(o.video,0,0,320,180),o.video.style.display="none",o.button.style.display="none",o.close.style.display="none",o.canvas.style.display="block",o.send.style.display="block",o.cancel.style.display="block",o.video.srcObject=null,o.video.pause()}),o.send.addEventListener("click",function(r){r.preventDefault();var s=o.canvas.toDataURL("image/png"),c=n._dataURItoBlob(s);n._uploadFile(c,"reply").then(function(o){t={media:o},n._handleReply(e,i,t)}),o.video.srcObject=null,o.video.pause(),a.getTracks()[0].stop(),o.bg.remove()}),o.cancel.addEventListener("click",function(e){e.preventDefault(),o.canvas.style.display="none",o.send.style.display="none",o.cancel.style.display="none",o.video.style.display="block",o.button.style.display="block",o.close.style.display="block",o.video.srcObject=a,o.video.play()}),o.close.addEventListener("click",function(t){t.preventDefault(),o.video.srcObject=null,o.video.pause(),a.getTracks()[0].stop(),o.bg.remove(),n.didNotExecuteAction(e,i)})})}},{key:"_replyWithCameraAndKeyboard",value:function(e,i,t){var n=this,o=this.UI_CONSTANTS;if(o.bg&&(o.bg.remove(),o.modal)){for(;o.modal.firstChild;)o.modal.removeChild(o.modal.firstChild);o.modal.remove()}navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(a){o.video.srcObject=a,o.video.play(),o.modal.appendChild(o.textarea),o.modal.appendChild(o.video),o.modal.appendChild(o.button),o.modal.appendChild(o.canvas),o.modal.appendChild(o.send),o.modal.appendChild(o.next),o.modal.appendChild(o.cancel),o.modal.appendChild(o.close),o.bg.appendChild(o.modal),o.body.appendChild(o.bg),o.canvas.style.display="none",o.textarea.style.display="none",o.textarea.value="",o.send.style.display="none",o.cancel.style.display="none",o.next.style.display="none",o.video.style.display="block",o.button.style.display="block",o.close.style.display="block",o.button.addEventListener("click",function(e){e.preventDefault(),o.context.drawImage(o.video,0,0,320,180),o.video.style.display="none",o.button.style.display="none",o.close.style.display="none",o.canvas.style.display="block",o.next.style.display="block",o.cancel.style.display="block",o.send.style.display="none",o.video.srcObject=null,o.video.pause()}),o.next.addEventListener("click",function(e){e.preventDefault();var i=o.canvas.toDataURL("image/png"),r=n._dataURItoBlob(i);n._uploadFile(r,"reply").then(function(e){t={media:e},o.textarea.style.display="block",o.send.style.display="block",o.canvas.style.display="none",o.next.style.display="none"}),o.video.srcObject=null,o.video.pause(),a.getTracks()[0].stop()}),o.send.addEventListener("click",function(a){a.preventDefault(),t.message=o.textarea.value,n._handleReply(e,i,t),o.bg.remove()}),o.cancel.addEventListener("click",function(e){e.preventDefault(),o.canvas.style.display="none",o.send.style.display="none",o.cancel.style.display="none",o.next.style.display="none",o.textarea.style.display="none",o.video.style.display="block",o.button.style.display="block",o.close.style.display="block",o.video.srcObject=a,o.video.play()}),o.close.addEventListener("click",function(t){t.preventDefault(),o.video.srcObject=null,o.video.pause(),a.getTracks()[0].stop(),o.bg.remove(),n.didNotExecuteAction(e,i)})})}},{key:"_replyWithTarget",value:function(e,i,t){var n,o,a,r,s=this,c=i.target.split("?");if(c.length>1)for(a=0,r=(n=c[1].split("&")).length;a<r;a++)o=n[a].split("="),t[o[0]]=o[1];t.target=c[0],t.label=i.label,e._id&&(t.notificationID=e._id),this.device.deviceID&&(t.deviceID=this.device.deviceID),this.device.userID&&(t.userID=this.device.userID),this.network.fetch("POST","/reply/webhook",!0,t).then(function(){s._handleReply(e,i,t)})}},{key:"_handleReply",value:function(e,i,t){var n=this;this._reply(e,i,t).then(function(){n.didExecuteAction(e,i)}).catch(function(){n.didFailToExecuteAction(e,i)})}},{key:"_reply",value:function(e,i,t){return this.network.fetch("POST","/reply",!0,{userID:this.device.userID,deviceID:this.device.deviceID,notification:e._id,data:t,label:i.label})}},{key:"_dataURItoBlob",value:function(e){var i=void 0,t=void 0;i=-1!==e.split(",")[0].indexOf("base64")?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),t=e.split(",")[0].split(":")[1].split(";")[0];for(var n=new Array,o=0;o<i.length;o++)n[o]=i.charCodeAt(o);return new Blob([new Uint8Array(n)],{type:t})}},{key:"_uploadFile",value:function(e,i){var t=new FormData;return t.append("file",e),this.network.fetch("POST","/upload/"+i,!0,t,!0).then(function(e){return"https://s3-eu-west-1.amazonaws.com/notificare-storage"+e.filename})}}]),e}()),NotificareScannables=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options)}return _createClass(e,[{key:"fetchScannable",value:function(e){var i=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null,t={};return i.userID&&(t.userID=i.userID),i.deviceID&&(t.deviceID=i.deviceID),this.network.fetch("GET","/scannable/tag/"+encodeURIComponent(e),!0,t)}}]),e}()),NotificareStorage=(_createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),function(){function e(i){_classCallCheck(this,e),this.options=i,this.core=new NotificareCore,this.network=new NotificareNetwork(this.options)}return _createClass(e,[{key:"fetchAssets",value:function(e){var i=this,t=localStorage.getItem("notificareDevice")?JSON.parse(localStorage.getItem("notificareDevice")):null,n={};return t.userID&&(n.userID=t.userID),t.deviceID&&(n.deviceID=t.deviceID),this.network.fetch("GET","/asset/forgroup/"+encodeURIComponent(e),!0,n).then(function(e){var t=[];return e&&e.assets&&e.assets.length>0&&e.assets.forEach(function(e){t.push({title:e.title,description:e.description,url:e.key?i.options.assetsUrl+e.key:null,metaData:e.metaData,extra:e.extra,button:e.button})}),t})}}]),e}()),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,i){var t="function",n="undefined",o="model",a="name",r="type",s="vendor",c="version",l="architecture",u="console",d="mobile",f="tablet",h="smarttv",p="wearable",g=function(e,i){var t={};for(var n in e)i[n]&&i[n].length%2==0?t[n]=i[n].concat(e[n]):t[n]=e[n];return t},v=function(e,i){return"string"==typeof e&&-1!==i.toLowerCase().indexOf(e.toLowerCase())},m=function(e){return e.toLowerCase()},y=function(e){return"string"===(void 0===e?"undefined":_typeof(e))?e.replace(/[^\d\.]/g,"").split(".")[0]:i},w=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},b={rgx:function(e,n){for(var o,a,r,s,c,l,u=0;u<n.length&&!c;){var d=n[u],f=n[u+1];for(o=a=0;o<d.length&&!c;)if(c=d[o++].exec(e))for(r=0;r<f.length;r++)l=c[++a],"object"===(void 0===(s=f[r])?"undefined":_typeof(s))&&s.length>0?2==s.length?_typeof(s[1])==t?this[s[0]]=s[1].call(this,l):this[s[0]]=s[1]:3==s.length?_typeof(s[1])!==t||s[1].exec&&s[1].test?this[s[0]]=l?l.replace(s[1],s[2]):i:this[s[0]]=l?s[1].call(this,l,s[2]):i:4==s.length&&(this[s[0]]=l?s[3].call(this,l.replace(s[1],s[2])):i):this[s]=l||i;u+=2}},str:function(e,t){for(var n in t)if("object"===_typeof(t[n])&&t[n].length>0){for(var o=0;o<t[n].length;o++)if(v(t[n][o],e))return"?"===n?i:n}else if(v(t[n],e))return"?"===n?i:n;return e}},k={oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},S={amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},I={windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}},N={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[a,c],[/(opios)[\/\s]+([\w\.]+)/i],[[a,"Opera Mini"],c],[/\s(opr)\/([\w\.]+)/i],[[a,"Opera"],c],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[a,c],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[a,"IE"],c],[/(edge)\/((\d+)?[\w\.]+)/i],[a,c],[/(yabrowser)\/([\w\.]+)/i],[[a,"Yandex"],c],[/(puffin)\/([\w\.]+)/i],[[a,"Puffin"],c],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[a,"UCBrowser"],c],[/(comodo_dragon)\/([\w\.]+)/i],[[a,/_/g," "],c],[/(micromessenger)\/([\w\.]+)/i],[[a,"WeChat"],c],[/(QQ)\/([\d\.]+)/i],[a,c],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[a,c],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[c,[a,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[c,[a,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[c,[a,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[a,/(.+)/,"$1 WebView"],c],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[a,/(.+(?:g|us))(.+)/,"$1 $2"],c],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[c,[a,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[a,c],[/(dolfin)\/([\w\.]+)/i],[[a,"Dolphin"],c],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[a,"Chrome"],c],[/(coast)\/([\w\.]+)/i],[[a,"Opera Coast"],c],[/fxios\/([\w\.-]+)/i],[c,[a,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[c,[a,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[c,a],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[a,"GSA"],c],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[a,[c,b.str,k.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[a,c],[/(navigator|netscape)\/([\w\.-]+)/i],[[a,"Netscape"],c],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[a,c]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[l,"amd64"]],[/(ia32(?=;))/i],[[l,m]],[/((?:i[346]|x)86)[;\)]/i],[[l,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[l,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[l,/ower/,"",m]],[/(sun4\w)[;\)]/i],[[l,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[l,m]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[o,s,[r,f]],[/applecoremedia\/[\w\.]+ \((ipad)/],[o,[s,"Apple"],[r,f]],[/(apple\s{0,1}tv)/i],[[o,"Apple TV"],[s,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[s,o,[r,f]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[o,[s,"Amazon"],[r,f]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[o,b.str,S.amazon.model],[s,"Amazon"],[r,d]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[o,s,[r,d]],[/\((ip[honed|\s\w*]+);/i],[o,[s,"Apple"],[r,d]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[s,o,[r,d]],[/\(bb10;\s(\w+)/i],[o,[s,"BlackBerry"],[r,d]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[o,[s,"Asus"],[r,f]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[s,"Sony"],[o,"Xperia Tablet"],[r,f]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[o,[s,"Sony"],[r,d]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[s,o,[r,u]],[/android.+;\s(shield)\sbuild/i],[o,[s,"Nvidia"],[r,u]],[/(playstation\s[34portablevi]+)/i],[o,[s,"Sony"],[r,u]],[/(sprint\s(\w+))/i],[[s,b.str,S.sprint.vendor],[o,b.str,S.sprint.model],[r,d]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[s,o,[r,f]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[s,[o,/_/g," "],[r,d]],[/(nexus\s9)/i],[o,[s,"HTC"],[r,f]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[o,[s,"Huawei"],[r,d]],[/(microsoft);\s(lumia[\s\w]+)/i],[s,o,[r,d]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[o,[s,"Microsoft"],[r,u]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[s,"Microsoft"],[r,d]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[o,[s,"Motorola"],[r,d]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[o,[s,"Motorola"],[r,f]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[s,w],[o,w],[r,h]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[s,"Samsung"],[r,h]],[/\(dtv[\);].+(aquos)/i],[o,[s,"Sharp"],[r,h]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[s,"Samsung"],o,[r,f]],[/smart-tv.+(samsung)/i],[s,[r,h],o],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[s,"Samsung"],o,[r,d]],[/sie-(\w+)*/i],[o,[s,"Siemens"],[r,d]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[s,"Nokia"],o,[r,d]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[o,[s,"Acer"],[r,f]],[/android.+([vl]k\-?\d{3})\s+build/i],[o,[s,"LG"],[r,f]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[s,"LG"],o,[r,f]],[/(lg) netcast\.tv/i],[s,o,[r,h]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[o,[s,"LG"],[r,d]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[o,[s,"Lenovo"],[r,f]],[/linux;.+((jolla));/i],[s,o,[r,d]],[/((pebble))app\/[\d\.]+\s/i],[s,o,[r,p]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[s,o,[r,d]],[/crkey/i],[[o,"Chromecast"],[s,"Google"]],[/android.+;\s(glass)\s\d/i],[o,[s,"Google"],[r,p]],[/android.+;\s(pixel c)\s/i],[o,[s,"Google"],[r,f]],[/android.+;\s(pixel xl|pixel)\s/i],[o,[s,"Google"],[r,d]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w?)?[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[o,/_/g," "],[s,"Xiaomi"],[r,d]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+)?)\s+build/i],[[o,/_/g," "],[s,"Xiaomi"],[r,f]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[o,[s,"Meizu"],[r,f]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[o,[s,"OnePlus"],[r,d]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[o,[s,"RCA"],[r,f]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[o,[s,"Dell"],[r,f]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[o,[s,"Verizon"],[r,f]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[s,"Barnes & Noble"],o,[r,f]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[o,[s,"NuVision"],[r,f]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[s,"ZTE"],o,[r,f]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[o,[s,"Swiss"],[r,d]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[o,[s,"Swiss"],[r,f]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[o,[s,"Zeki"],[r,f]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[s,"Dragon Touch"],o,[r,f]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[o,[s,"Insignia"],[r,f]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[o,[s,"NextBook"],[r,f]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[s,"Voice"],o,[r,d]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[s,"LvTel"],o,[r,d]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[o,[s,"Envizen"],[r,f]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[s,o,[r,f]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[o,[s,"MachSpeed"],[r,f]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[s,o,[r,f]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[o,[s,"Rotor"],[r,f]],[/android.+(KS(.+))\s+build/i],[o,[s,"Amazon"],[r,f]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[s,o,[r,f]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[r,m],s,o],[/(android.+)[;\/].+build/i],[o,[s,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[c,[a,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[a,c],[/rv\:([\w\.]+).*(gecko)/i],[c,a]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[a,c],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[a,[c,b.str,I.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[a,"Windows"],[c,b.str,I.windows.version]],[/\((bb)(10);/i],[[a,"BlackBerry"],c],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[a,c],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[a,"Symbian"],c],[/\((series40);/i],[a],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[a,"Firefox OS"],c],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[a,c],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[a,"Chromium OS"],c],[/(sunos)\s?([\w\.]+\d)*/i],[[a,"Solaris"],c],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[a,c],[/(haiku)\s(\w+)/i],[a,c],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[c,/_/g,"."],[a,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[a,"Mac OS"],[c,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[a,c]]},C=function t(n,o){if("object"===(void 0===n?"undefined":_typeof(n))&&(o=n,n=i),!(this instanceof t))return new t(n,o).getResult();var a=n||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:""),r=o?g(N,o):N;return this.getBrowser=function(){var e={name:i,version:i};return b.rgx.call(e,a,r.browser),e.major=y(e.version),e},this.getCPU=function(){var e={architecture:i};return b.rgx.call(e,a,r.cpu),e},this.getDevice=function(){var e={vendor:i,model:i,type:i};return b.rgx.call(e,a,r.device),e},this.getEngine=function(){var e={name:i,version:i};return b.rgx.call(e,a,r.engine),e},this.getOS=function(){var e={name:i,version:i};return b.rgx.call(e,a,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return a},this.setUA=function(e){return a=e,this},this};C.VERSION="0.7.17",C.BROWSER={NAME:a,MAJOR:"major",VERSION:c},C.CPU={ARCHITECTURE:l},C.DEVICE={MODEL:o,VENDOR:s,TYPE:r,CONSOLE:u,MOBILE:d,SMARTTV:h,TABLET:f,WEARABLE:p,EMBEDDED:"embedded"},C.ENGINE={NAME:a,VERSION:c},C.OS={NAME:a,VERSION:c},("undefined"==typeof exports?"undefined":_typeof(exports))!==n?(("undefined"==typeof module?"undefined":_typeof(module))!==n&&module.exports&&(exports=module.exports=C),exports.UAParser=C):("undefined"==typeof define?"undefined":_typeof(define))===t&&define.amd?define(function(){return C}):e&&(e.UAParser=C);var T=e&&(e.jQuery||e.Zepto);if((void 0===T?"undefined":_typeof(T))!==n){var D=new C;T.ua=D.getResult(),T.ua.get=function(){return D.getUA()},T.ua.set=function(e){D.setUA(e);var i=D.getResult();for(var t in i)T.ua[t]=i[t]}}}("object"===("undefined"==typeof window?"undefined":_typeof(window))?window:void 0);